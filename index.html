<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ã‚ã¡ã‚ƒã¤ã‚ˆãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ã®ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒ¼ã‚¯</title>

<style>
:root{
  --bg:#97d2e4; --ink:#0c2a33; --muted:#215b6b; --white:#fff;
  --pill:#e6f7fd; --btn:#10aee3; --btn-ink:#fff; --card:#ffffffef;
  --win:#0da66e; --lose:#d94848;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
.wrap{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
.container{width:min(920px,92vw);margin:0 auto;padding:16px 0 26px}

/* å…±é€š */
h1{margin:8px 0 4px;font-size:clamp(22px,5.8vw,36px);letter-spacing:.06em;text-align:center}
.sub{margin:0 0 10px;color:var(--muted);text-align:center;font-size:clamp(12px,3.4vw,15px)}
.score{margin:12px 0 6px;text-align:center;font-weight:800;font-size:clamp(22px,7.2vw,34px)}
.message{margin:8px 0 18px;text-align:center;font-size:clamp(14px,4.2vw,18px)}
.pill{display:inline-block;padding:.45em 1em;border-radius:999px;background:var(--pill);
  font-weight:700;color:#222;font-size:clamp(12px,3.8vw,16px)}
.btnrow{display:flex;gap:14px;justify-content:center;align-items:center;margin:10px 0 0;position:relative;z-index:5;flex-wrap:wrap}
.btn{appearance:none;border:none;border-radius:14px;cursor:pointer;font-weight:800;letter-spacing:.06em}
.btn.primary{background:var(--btn);color:var(--btn-ink);padding:14px 22px;font-size:clamp(14px,4.8vw,18px)}
.btn.ghost{background:transparent;color:#083b48;border:2px solid #083b4840;
  padding:12px 20px;border-radius:16px;font-size:clamp(14px,4.8vw,18px)}
.resultCard{display:none;margin:12px auto 0;max-width:780px;background:var(--card);
  border-radius:16px;padding:12px 14px;text-align:center;font-size:clamp(14px,4.4vw,18px);box-shadow:0 12px 28px #07495926}
.win{color:var(--win);font-weight:800}.lose{color:var(--lose);font-weight:800}

/* ========== ã‚¿ã‚¤ãƒˆãƒ« ========== */
#title{display:grid;place-items:center}
#title .hero{
  width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:8px;
  background:url('bg-title.png') center/cover no-repeat; border-radius:24px; padding:16px 12px 26px;
}
#title h2{margin:0;text-align:center;line-height:1.25;font-size:clamp(22px,6.2vw,34px)}
.title-illus{width:min(620px,92vw);max-height:62svh;object-fit:contain;object-position:center bottom;
  display:block;margin:8px auto 2px;pointer-events:none}
.speech{display:none;margin:2px auto 0;padding:.6em 1em;border-radius:12px;background:#fff;
  box-shadow:0 8px 24px rgba(0,0,0,.12);font-weight:800;text-align:center}

/* ========== ã˜ã‚ƒã‚“ã‘ã‚“ ========== */
#game{display:none}
.topRow{margin-top:4px;display:flex;align-items:flex-start;justify-content:space-between;gap:clamp(10px,4vw,18px)}
.frameBox{position:relative;flex:0 0 auto;width:clamp(160px,40vw,320px);aspect-ratio:3/4;background:url("frame2.png") center/contain no-repeat;}
.bossHandImg{position:absolute;left:8%;top:6%;width:84%;height:88%;object-fit:contain;filter:drop-shadow(0 10px 16px #00000018)}
.bossPic{flex:0 0 auto;width:clamp(200px,42vw,360px);height:auto;object-fit:contain;filter:drop-shadow(0 10px 20px rgba(0,0,0,.12))}
.hands{margin:16px auto 0;display:flex;justify-content:center;gap:clamp(12px,4vw,18px)}
.handBtn{width:clamp(92px,22vw,136px);aspect-ratio:1/1;border-radius:18px;background:var(--white);
  box-shadow:0 10px 30px #075a6a22;display:grid;place-items:center;font-size:clamp(34px,10vw,52px);cursor:pointer;border:none}
.restartRow{display:none;justify-content:center;margin:14px 0 0}

/* ========== ç¥çµŒè¡°å¼±(1äºº) ========== */
#memory{display:none}
.memDiff{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin: 6px 0 6px; }
.memHud{ display:flex; gap:14px; justify-content:center; align-items:center; margin: 10px 0 10px; font-weight:700; flex-wrap:wrap; }
.memGrid{ --gap: clamp(10px, 3.4vw, 14px); display:grid; gap: var(--gap); grid-template-columns: repeat(4, 1fr); width:min(740px, 92vw); margin: 0 auto; }
.memCard{ aspect-ratio: 1 / 1; perspective: 1000px; position:relative; }
.memInner{ position:absolute; inset:0; transition: transform .42s ease; transform-style: preserve-3d; transform: rotateY(180deg);}
.memInner.flipped{ transform: rotateY(0deg); }
.memFace{ position:absolute; inset:0; border-radius:16px; overflow:hidden; backface-visibility:hidden; box-shadow:0 10px 24px rgba(0,0,0,.12); display:grid; place-items:center; }
.memFace.front{ background:#fff; transform: rotateY(0deg); }
.memFace.back{ background: linear-gradient(135deg, #c9f0ff, #97d2e4); color:#084357; font-size: clamp(22px, 6.4vw, 28px); transform: rotateY(180deg); }
.memFace.front img{ width: 78%; height: 78%; object-fit: contain; pointer-events:none; }
.memInner.matched{ animation: pop .36s ease; }
@keyframes pop{ 0%{ transform: rotateY(0deg) scale(1)} 50%{ transform: rotateY(0deg) scale(1.06)} 100%{ transform: rotateY(0deg) scale(1)} }
.lives{ display:flex; gap:6px; align-items:center; font-size:clamp(18px,5.4vw,22px) }
.lives .heart{ transition: .2s ease; }
.lives .heart.lost{ opacity:.3; filter:grayscale(1); transform:scale(.92); }

/* ========== 2048 ========== */
#scoop{display:none}
.scoopHud{display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
.scoopHud span{background:#ffffffcc;padding:8px 12px;border-radius:10px;box-shadow:0 6px 16px #00000012}
.scoopBtns{display:flex;gap:10px}
.scoopBoard{width:min(520px,92vw);margin:12px auto 0;position:relative}
.scGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:#bde3ef;padding:10px;border-radius:14px;}
.scGrid .cell{aspect-ratio:1/1;border-radius:10px;background:#e6f7fd}
.scTiles{position:absolute;inset:0;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px}
.scTiles>.slot{aspect-ratio:1/1}
.tile{width:100%;height:100%;border-radius:12px;display:grid;place-items:center;font-weight:900;text-align:center;line-height:1.1;box-shadow:0 10px 24px rgba(0,0,0,.12);user-select:none;animation:tileIn .18s ease;color:#083b48;font-size:clamp(12px,3.6vw,15px)}
.tile b{display:block;font-size:clamp(18px,6vw,26px)}
@keyframes tileIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
.tile.merge{animation:mergePop .22s ease}
@keyframes mergePop{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
.t2{background:#fffdf5}.t4{background:#fff6da}
.t8{background:#ffe1e9}.t16{background:#f6d7c7}
.t32{background:#d8f0dc}.t64{background:#d7f0fb}
.t128{background:#ffe9c2}.t256{background:#f7d9ff}
.t512{background:#d9fff1}.t1024{background:#fff0c5}.t2048{background:#ffe7e7}
.tileImg{width:86%;height:86%;object-fit:contain;pointer-events:none}
#scPad{position:sticky;bottom:env(safe-area-inset-bottom,12px);display:none;margin-top:16px}
.pad{width:180px;height:160px;margin:0 auto;position:relative;display:grid;place-items:center}
.pad button{position:absolute;width:56px;height:56px;border-radius:50%;border:none;background:#ffffffd8;box-shadow:0 8px 18px #00000018;font-size:22px;font-weight:900;color:#0c2a33;cursor:pointer}
.pad .up{top:0;left:50%;transform:translate(-50%,0)}
.pad .down{bottom:0;left:50%;transform:translate(-50%,0)}
.pad .left{left:0;top:50%;transform:translate(0,-50%)}
.pad .right{right:0;top:50%;transform:translate(0,-50%)}

/* ========== 2äººãƒ—ãƒ¬ã‚¤(é¸æŠ) ========== */
#versus{display:none}
.roster{display:grid;grid-template-columns:repeat(4,minmax(120px,1fr));gap:14px;width:min(860px,92vw);margin:8px auto 0}
.charCard{background:#fff;border-radius:16px;box-shadow:0 8px 18px #00000018;cursor:pointer;padding:10px;text-align:center;transition:.15s}
.charCard:hover{transform:translateY(-2px)}
.charCard img{width:100%;height:auto;border-radius:12px;display:block}
.charName{margin-top:6px;font-weight:800;letter-spacing:.02em}
.charCard.disabled{opacity:.45;pointer-events:none}

/* ========== â—¯âœ•ã‚²ãƒ¼ãƒ  ========== */
#tic{display:none}
.ticHud{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
.playerBadge{display:flex;align-items:center;gap:8px;background:#fff;border-radius:999px;padding:6px 12px;box-shadow:0 6px 16px #00000018}
.badgePic{width:34px;height:34px;border-radius:50%;object-fit:cover}
.turnRing{outline:3px solid #ff4d4f;outline-offset:3px;border-radius:999px}
.ticBoard{width:min(520px,92vw);margin:10px auto 0;padding:12px;border-radius:18px;background:url('stage33.png') center/cover no-repeat, #bde3ef;box-shadow:inset 0 0 0 8px #6ec0e3}
.ticGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
.ticCell{aspect-ratio:1/1;border-radius:14px;background:#e6f7fd;display:grid;place-items:center;cursor:pointer;font-size:clamp(26px,9vw,42px);color:#063442;font-weight:900}
.ticCell.mark{background:#fff}
.ticSay{font-size:12px;color:#0b4150}

/* ========== å››ç›®ä¸¦ã¹(ã‚³ã‚¤ãƒ³è½ã¨ã—) ========== */
#c4{display:none}
.c4Hud{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
.c4BoardWrap{width:min(720px,92vw);margin:10px auto 0;border-radius:18px;background:url('stage76.png') center/cover no-repeat, #bde3ef;box-shadow:inset 0 0 0 10px #2aa1e0}
.c4Grid{--cols:7;--rows:6;display:grid;grid-template-columns:repeat(7,1fr);gap:10px;padding:10px}
.c4Cell{aspect-ratio:1/1;border-radius:50%;background:#eaf7ff;position:relative;overflow:visible}
.chip{position:absolute;inset:8%;border-radius:50%;display:block;object-fit:contain;animation:drop .35s ease-out both}
@keyframes drop{from{transform:translateY(calc(-120% * var(--r,1)));opacity:.6}to{transform:translateY(0);opacity:1}}
.pointerRow{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;padding:0 10px 10px}
.pointerRow button{height:16px;border:none;border-radius:10px;background:#ffffffaa;cursor:pointer}
.pointerRow button:hover{background:#fff}
</style>
</head>

<body>
<div class="wrap">

  <!-- ============= ã‚¿ã‚¤ãƒˆãƒ« ============= -->
  <div class="container" id="title">
    <div class="hero">
      <span class="pill" id="titlePill">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒ¼ã‚¯</span>
      <h2 id="titleHeading">ã‚ã¡ã‚ƒã¤ã‚ˆãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ã¨ã®<br>ã‚¸ãƒ£ãƒ³ã‚±ãƒ³å¯¾æ±ºï¼</h2>

      <img id="titleImg" class="title-illus" src="title-start2.png" alt="åº—é•·ãƒãƒ¼ã‚º">
      <div id="speech" class="speech">ä¿ºã®å¼·ã•ã«æ€–æ°—ã¥ã„ãŸã‹ã£ï¼</div>

      <div class="btnrow" id="titleJankenRow">
        <button class="btn primary" id="btnStart">æŒ‘æˆ¦ã™ã‚‹</button>
        <button class="btn ghost"   id="btnQuit"  data-mode="quit">ã‚ãã‚‰ã‚ã‚‹</button>
      </div>

      <div class="btnrow">
        <button class="btn ghost" id="btnScoop">2048ã§éŠã¶</button>
        <button class="btn ghost" id="btn2p">2äººã§éŠã¶</button>
      </div>
      <div class="btnrow">
        <button class="btn ghost" id="btnMem">ç¥çµŒè¡°å¼±ï¼ˆ1äººï¼‰</button>
        <button class="btn ghost" id="btnJanken">ã˜ã‚ƒã‚“ã‘ã‚“</button>
      </div>
      <p class="title-note">åº—é•· vs ã¿ã‚“ãªã§ã€ã‚†ã‚‹ã£ã¨å¯¾æˆ¦ï¼</p>
    </div>
  </div>

  <!-- ============= ã˜ã‚ƒã‚“ã‘ã‚“ ============= -->
  <div class="container" id="game">
    <div class="topRow">
      <div class="frameBox"><img id="bossHandImg" class="bossHandImg" src="rock2.png" alt="åº—é•·ã®æ‰‹"></div>
      <img class="bossPic" src="boss2.png" alt="åº—é•·">
    </div>
    <h1>ï½åº—é•·ã¨ã‚¸ãƒ£ãƒ³ã‚±ãƒ³å‹è² ï½</h1>
    <p class="sub">å…ˆã«3å›å‹ã£ãŸæ–¹ãŒå‹ã¡ï¼</p>
    <div class="score" id="score">ã‚ãªãŸ 0 - åº—é•· 0</div>
    <div class="message" id="message">æ‰‹ã‚’é¸ã‚“ã§ã­ï¼</div>
    <div class="hands" id="hands">
      <button class="handBtn" data-hand="rock"     aria-label="ã‚°ãƒ¼">âœŠ</button>
      <button class="handBtn" data-hand="scissors" aria-label="ãƒãƒ§ã‚­">âœŒï¸</button>
      <button class="handBtn" data-hand="paper"    aria-label="ãƒ‘ãƒ¼">âœ‹</button>
    </div>
    <div class="resultCard" id="resultCard"></div>
    <div class="restartRow" id="restartRow"><button class="btn ghost" id="restartBtn">å†æŒ‘æˆ¦</button></div>
    <div class="btnrow" style="margin-top:12px"><button class="btn ghost" id="backToTitle1">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ============= ç¥çµŒè¡°å¼±(1äºº) ============= -->
  <div class="container" id="memory">
    <h1>ã€œç¥çµŒè¡°å¼±ã€œ</h1>
    <p class="sub">åŒã˜ã‚¢ã‚¤ã‚¹ã‚’2æšã‚ãã£ã¦ãƒšã‚¢ã‚’ä½œã‚ã†ï¼</p>
    <div class="memDiff">
      <button class="btn primary" id="memEasyBtn">ã‚„ã•ã—ã„ï¼ˆ4ãƒšã‚¢ï¼‰</button>
      <button class="btn ghost"   id="memHardBtn">ã‚€ãšã‹ã—ã„ï¼ˆ6ãƒšã‚¢ï¼‰</button>
    </div>
    <div class="memHud" id="memHud" style="display:none">
      <span id="memMoves">æ‰‹æ•°: 0</span>
      <span id="memPairs">ãƒšã‚¢: 0 / 4</span>
      <span class="lives" id="memLives" title="ãƒ©ã‚¤ãƒ•"><span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span></span>
      <button class="btn ghost" id="memRetry">ã‚‚ã†ä¸€å›</button>
    </div>
    <div class="memGrid" id="memGrid" aria-label="ã‚«ãƒ¼ãƒ‰ã®å ´"></div>
    <div class="resultCard" id="memResult" style="display:none; margin-top:14px"></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="memBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ============= 2048 ============= -->
  <div class="container" id="scoop">
    <h1>ã€œ2048ãƒ‘ã‚ºãƒ«ã€œ</h1>
    <p class="sub">åŒã˜æ•°å­—ã‚’åˆä½“ã•ã›ã¦é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†</p>
    <div class="scoopHud">
      <span id="scScore">ã‚¹ã‚³ã‚¢: 0</span>
      <span id="scBest">ãƒ™ã‚¹ãƒˆ: 0</span>
      <div class="scoopBtns">
        <button class="btn ghost" id="scUndo">1æ‰‹æˆ»ã‚‹</button>
        <button class="btn ghost" id="scRetry">ã‚‚ã†ä¸€å›</button>
      </div>
    </div>
    <div class="scoopBoard">
      <div class="scGrid" id="scGridBg"></div>
      <div class="scTiles" id="scTiles"></div>
    </div>
    <div class="resultCard" id="scResult" style="display:none; margin-top:14px"></div>
    <div id="scPad"><div class="pad">
      <button class="up"    aria-label="ä¸Šã¸">â†‘</button>
      <button class="left"  aria-label="å·¦ã¸">â†</button>
      <button class="right" aria-label="å³ã¸">â†’</button>
      <button class="down"  aria-label="ä¸‹ã¸">â†“</button>
    </div></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="scBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ============= 2äººãƒ—ãƒ¬ã‚¤ï¼šäº¤äº’ã«é¸ã¶ ============= -->
  <div class="container" id="versus" style="display:none">
    <h1>2äººã§éŠã¶</h1>
    <p class="sub"><span class="pill" id="vsTurnPill">P1 ã‚’é¸ã‚“ã§ã­</span></p>
    <div class="roster" id="vsRoster"></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="vsBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- 2äººãƒ—ãƒ¬ã‚¤ï¼šã‚²ãƒ¼ãƒ é¸æŠ -->
  <div class="container" id="vsGameMenu" style="display:none">
    <h1>ã‚²ãƒ¼ãƒ ã‚’é¸ã¶</h1>
    <p class="sub">é¸ã‚“ã ã‚­ãƒ£ãƒ©ã§å¯¾æˆ¦ï¼</p>
    <div class="btnrow">
      <button class="btn primary" id="goTic">â—¯âœ•ã‚²ãƒ¼ãƒ </button>
      <button class="btn primary" id="goConnect4">ã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰</button>
      <button class="btn ghost"   id="goMem2p" disabled>ç¥çµŒè¡°å¼±ï¼ˆ2äººï¼‰â€»å¾Œæ—¥</button>
    </div>
    <div class="btnrow" style="margin-top:10px">
      <button class="btn ghost" id="vsGameBack">ã‚­ãƒ£ãƒ©ã‚’é¸ã³ç›´ã™</button>
      <button class="btn ghost" id="vsGameToTitle">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= â—¯âœ•ã‚²ãƒ¼ãƒ  ============= -->
  <div class="container" id="tic" style="display:none">
    <h1>ã€œâ—¯âœ•ã‚²ãƒ¼ãƒ ã€œ</h1>
    <div class="ticHud">
      <div class="playerBadge" id="ticP1"><img class="badgePic" id="ticP1pic"><div><div id="ticP1name">P1</div><div class="ticSay" id="ticP1say">ã€€</div></div></div>
      <span class="pill" id="ticTurn">P1ã®ã‚¿ãƒ¼ãƒ³</span>
      <div class="playerBadge" id="ticP2"><img class="badgePic" id="ticP2pic"><div><div id="ticP2name">P2</div><div class="ticSay" id="ticP2say">ã€€</div></div></div>
    </div>
    <div class="ticBoard"><div class="ticGrid" id="ticGrid"></div></div>
    <div class="resultCard" id="ticResult"></div>
    <div class="btnrow"><button class="btn ghost" id="ticRetry">ã‚‚ã†ä¸€å›</button><button class="btn ghost" id="ticOther">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="ticBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ============= å››ç›®ä¸¦ã¹ ============= -->
  <div class="container" id="c4" style="display:none">
    <h1>ã€œã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰ã€œ</h1>
    <div class="c4Hud">
      <div class="playerBadge" id="c4P1"><img class="badgePic" id="c4P1pic"><div><div id="c4P1name">P1</div></div></div>
      <span class="pill" id="c4Turn">P1ã®ã‚¿ãƒ¼ãƒ³</span>
      <div class="playerBadge" id="c4P2"><img class="badgePic" id="c4P2pic"><div><div id="c4P2name">P2</div></div></div>
    </div>
    <div class="c4BoardWrap">
      <div class="pointerRow" id="c4Pointers"></div>
      <div class="c4Grid" id="c4Grid"></div>
    </div>
    <div class="resultCard" id="c4Result"></div>
    <div class="btnrow"><button class="btn ghost" id="c4Retry">ã‚‚ã†ä¸€å›</button><button class="btn ghost" id="c4Other">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="c4Back">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

</div><!-- /.wrap -->

<script>
/* ===== ç”»é¢å‚ç…§ ===== */
const titleView = document.getElementById('title');
const gameView  = document.getElementById('game');
const memView   = document.getElementById('memory');
const scoopView = document.getElementById('scoop');
const vsView    = document.getElementById('versus');
const vsGameMenu= document.getElementById('vsGameMenu');
const ticView   = document.getElementById('tic');
const c4View    = document.getElementById('c4');

/* ===== ã‚¿ã‚¤ãƒˆãƒ«ï¼šãƒœã‚¿ãƒ³ ===== */
const titleImg  = document.getElementById('titleImg');
const speech    = document.getElementById('speech');
const btnStart  = document.getElementById('btnStart');
const btnQuit   = document.getElementById('btnQuit');
document.getElementById('btnScoop').addEventListener('click', showScoop);
document.getElementById('btn2p').addEventListener('click', showVersus);
document.getElementById('btnMem').addEventListener('click', showMemoryMenu);
document.getElementById('btnJanken').addEventListener('click', startGame);

btnQuit.addEventListener('click', () => {
  if (btnQuit.dataset.mode === 'quit') {
    speech.style.display = 'block';
    titleImg.src = 'title-quit2.png';
    btnQuit.textContent = 'æŒ‘æˆ¦ã™ã‚‹';
    btnQuit.dataset.mode = 'start';
    btnQuit.classList.remove('ghost'); btnQuit.classList.add('primary');
  } else { startGame(); }
});
btnStart.addEventListener('click', startGame);

function showTitle(){
  [gameView,memView,scoopView,vsView,vsGameMenu,ticView,c4View].forEach(v=>v.style.display='none');
  titleView.style.display='block';
  speech.style.display='none';
  titleImg.src = 'title-start2.png';
  btnQuit.textContent = 'ã‚ãã‚‰ã‚ã‚‹';
  btnQuit.dataset.mode = 'quit';
  btnQuit.classList.add('ghost'); btnQuit.classList.remove('primary');
  window.scrollTo({top:0, behavior:'smooth'});
}

/* =================================================
   ã˜ã‚ƒã‚“ã‘ã‚“
   ================================================= */
function startGame(){
  [titleView,memView,scoopView,vsView,vsGameMenu,ticView,c4View].forEach(v=>v.style.display='none');
  gameView.style.display = 'block';
  resetGame();
  window.scrollTo({top:0,behavior:'smooth'});
}
const WIN_TARGET=3, BOSS_EDGE=0.70;
const scoreEl=document.getElementById('score'), messageEl=document.getElementById('message');
const handsWrap=document.getElementById('hands'), resultCard=document.getElementById('resultCard'), restartRow=document.getElementById('restartRow');
const bossHandImg=document.getElementById('bossHandImg');
let score = { you:0, boss:0 };
const IMG    = { rock:'rock2.png', scissors:'scissors2.png', paper:'paper2.png' };
const WINMAP = { rock:'scissors', scissors:'paper', paper:'rock' };
function resetGame(){ score.you=0; score.boss=0; updateScore(); messageEl.textContent='æ‰‹ã‚’é¸ã‚“ã§ã­ï¼'; bossHandImg.src=IMG.rock; resultCard.style.display='none'; restartRow.style.display='none'; handsWrap.style.display='flex'; }
function updateScore(){ scoreEl.textContent=`ã‚ãªãŸ ${score.you} - åº—é•· ${score.boss}`; }
function bossPick(player){
  const beat = ({rock:'paper', paper:'scissors', scissors:'rock'})[player];
  const lose = WINMAP[player];
  const tie  = player;
  if (Math.random() < BOSS_EDGE) return beat;
  return [lose, tie][Math.random()<0.5 ? 0 : 1];
}
function play(player){
  if (handsWrap.style.display==='none') return;
  const boss = bossPick(player); bossHandImg.src = IMG[boss];
  if (player===boss){ messageEl.textContent='ã‚ã„ã“ï¼æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­'; }
  else if (WINMAP[player]===boss){ score.you++; updateScore(); messageEl.innerHTML=`<span class="win">ã‚ãªãŸã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`; }
  else { score.boss++; updateScore(); messageEl.innerHTML=`<span class="lose">åº—é•·ã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`; }
  checkFinish();
}
function checkFinish(){
  if (score.you>=WIN_TARGET || score.boss>=WIN_TARGET){
    handsWrap.style.display='none'; resultCard.style.display='block'; restartRow.style.display='flex';
    resultCard.innerHTML = (score.you>=WIN_TARGET)
      ? `<strong>ğŸ‰ ã‚ãªãŸã®å‹ã¡ï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`
      : `<strong>ğŸ‘‘ åº—é•·ã®å‹ã¡ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;
  }
}
document.querySelectorAll('.handBtn').forEach(b=>b.addEventListener('click', ()=>play(b.dataset.hand)));
document.getElementById('restartBtn').addEventListener('click', resetGame);
document.getElementById('backToTitle1').addEventListener('click', showTitle);

/* =================================================
   ç¥çµŒè¡°å¼±ï¼ˆ1äººï¼‰
   ================================================= */
const USE_ICE_IMAGES=true;
const ICE_SET=[
  { img:'ice1.png', emoji:'ğŸ¨', name:'ãƒ—ãƒ¬ãƒ¼ãƒ³' },
  { img:'ice2.png', emoji:'ğŸ«', name:'ãƒãƒ§ã‚³' },
  { img:'ice3.png', emoji:'ğŸµ', name:'ãã®ãèŒ¶' },
  { img:'ice4.png', emoji:'ğŸ””', name:'ã¡ã‚Šã‚“ã¡ã‚Šã‚“ãã‚“' },
  { img:'ice5.png', emoji:'ğŸ‘¨', name:'åº—é•·1' },
  { img:'ice6.png', emoji:'ğŸ§‘', name:'åº—é•·2' },
];
const memGrid=document.getElementById('memGrid');
const memHud=document.getElementById('memHud');
const memMoves=document.getElementById('memMoves');
const memPairs=document.getElementById('memPairs');
const memRetry=document.getElementById('memRetry');
const memBack=document.getElementById('memBack');
const memResult=document.getElementById('memResult');
const memLives=document.getElementById('memLives');
const memEasyBtn=document.getElementById('memEasyBtn');
const memHardBtn=document.getElementById('memHardBtn');
const MAX_LIVES=3; let TYPES_COUNT=4; let memDeck=[]; let first=null, second=null, lock=false; let pairs=0, moves=0; let lives=MAX_LIVES; let memOver=false;
function showMemoryMenu(){ [titleView,gameView,scoopView,vsView,vsGameMenu,ticView,c4View].forEach(v=>v.style.display='none'); memView.style.display='block'; memHud.style.display='none'; memGrid.innerHTML=''; memResult.style.display='none'; window.scrollTo({top:0,behavior:'smooth'}); }
memEasyBtn.addEventListener('click', ()=> startMemory(4));
memHardBtn.addEventListener('click', ()=> startMemory(6));
function startMemory(types=4){
  TYPES_COUNT=types; buildMemDeck(); renderMem(); pairs=0; moves=0; lock=false; first=second=null; memOver=false; lives=MAX_LIVES;
  updateMemHud(); renderLives(); memResult.style.display='none'; memHud.style.display='flex'; window.scrollTo({top:0,behavior:'smooth'});
}
function updateMemHud(){ memMoves.textContent=`æ‰‹æ•°: ${moves}`; memPairs.textContent=`ãƒšã‚¢: ${pairs} / ${TYPES_COUNT}`; }
function renderLives(){ const hearts=memLives.querySelectorAll('.heart'); hearts.forEach((h,i)=>h.classList.toggle('lost', i>=lives)); }
function buildMemDeck(){ memDeck=[]; for(let i=0;i<TYPES_COUNT;i++){ memDeck.push({id:i}); memDeck.push({id:i}); } for(let i=memDeck.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [memDeck[i],memDeck[j]]=[memDeck[j],memDeck[i]]; } }
function renderMem(){
  memGrid.innerHTML=''; memDeck.forEach((card,idx)=>{
    const c=document.createElement('div'); c.className='memCard'; c.dataset.index=idx;
    const inner=document.createElement('div'); inner.className='memInner'; inner.setAttribute('role','button'); inner.setAttribute('aria-label','ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹');
    const front=document.createElement('div'); front.className='memFace front';
    const img=document.createElement('img'); img.src=ICE_SET[card.id].img; img.alt=ICE_SET[card.id].name;
    const emoji=document.createElement('span'); emoji.textContent=ICE_SET[card.id].emoji; emoji.style.fontSize='clamp(32px,10vw,56px)';
    img.addEventListener('load',()=>{emoji.style.display='none'}); img.addEventListener('error',()=>{img.style.display='none'});
    front.append(img,emoji);
    const back=document.createElement('div'); back.className='memFace back'; back.textContent='ğŸ¨';
    inner.append(front,back); c.append(inner); memGrid.append(c);
    c.addEventListener('click',()=>flipMem(idx, inner));
  });
}
function flipMem(idx,innerEl){
  if (memOver||lock) return; if (innerEl.classList.contains('flipped')) return;
  innerEl.classList.add('flipped'); if (!first){ first={idx,id:memDeck[idx].id,el:innerEl}; navigator.vibrate?.(15); return; }
  second={idx,id:memDeck[idx].id,el:innerEl}; lock=true; moves++; updateMemHud();
  if (first.id===second.id){ setTimeout(()=>{ first.el.classList.add('matched'); second.el.classList.add('matched'); pairs++; updateMemHud(); first=second=null; lock=false;
      if (pairs>=TYPES_COUNT){ memOver=true; memResult.style.display='block'; memResult.innerHTML=`<strong>ğŸ‰ ãœã‚“ã¶ãã‚ã£ãŸï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`; } navigator.vibrate?.([20,40,20]); },220);
  } else {
    lives=Math.max(0,lives-1); renderLives();
    setTimeout(()=>{ first.el.classList.remove('flipped'); second.el.classList.remove('flipped'); first=second=null; lock=false; navigator.vibrate?.(30);
      if (lives<=0 && !memOver){ memOver=true; memResult.style.display='block'; memResult.innerHTML=`<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`; }
    },700);
  }
}
memRetry.addEventListener('click', ()=> startMemory(TYPES_COUNT));
memBack.addEventListener('click', showTitle);

/* =================================================
   2048ï¼ˆåˆæˆãƒ‘ã‚ºãƒ«ï¼‰ ï¼ŠçŸ¢å°ãƒ‘ãƒƒãƒ‰å¾©æ´»
   ================================================= */
const scGridBg=document.getElementById('scGridBg'), scTiles=document.getElementById('scTiles');
const scScore=document.getElementById('scScore'), scBest=document.getElementById('scBest');
const scUndo=document.getElementById('scUndo'), scRetry=document.getElementById('scRetry'), scResult=document.getElementById('scResult');
const IMAGE_LABEL={128:'å±‹å°',256:'ã‚¢ã‚¤ã‚¹',512:'åº—é•·',1024:'åº—é•·ã‚­ãƒ¡ãƒãƒ¼ã‚º',2048:'ç¤¾é•·'};
let board=[], scoreNow=0, best=Number(localStorage.getItem('scoop_best')||0), prevState=null;
function showScoop(){ [titleView,gameView,memView,vsView,vsGameMenu,ticView,c4View].forEach(v=>v.style.display='none'); scoopView.style.display='block'; setupScoop(); document.getElementById('scPad').style.display='block'; window.scrollTo({top:0,behavior:'smooth'}); }
document.getElementById('scBack').addEventListener('click', ()=>{ document.getElementById('scPad').style.display='none'; showTitle(); });
function setupScoop(){ if (!scGridBg.childElementCount){ for(let i=0;i<16;i++){ const c=document.createElement('div'); c.className='cell'; scGridBg.appendChild(c); } }
  best=Number(localStorage.getItem('scoop_best')||0); scoreNow=0; board=new Array(16).fill(0); prevState=null; spawn(); spawn(); draw(); scResult.style.display='none'; }
function spawn(){ const zeros=board.map((v,i)=>v===0?i:null).filter(v=>v!==null); if(!zeros.length) return false; const pos=zeros[Math.floor(Math.random()*zeros.length)]; board[pos]=Math.random()<0.9?2:4; return true; }
function canMove(){ if(board.includes(0)) return true; for(let r=0;r<4;r++)for(let c=0;c<4;c++){ const i=r*4+c,v=board[i]; if(c<3 && board[i+1]===v) return true; if(r<3 && board[i+4]===v) return true; } return false; }
function lineMove(line){ let arr=line.filter(v=>v!==0); let scoreGain=0; for(let i=0;i<arr.length-1;i++){ if(arr[i]!==0 && arr[i]===arr[i+1]){ arr[i]*=2; scoreGain+=arr[i]; arr[i+1]=0; i++; } } arr=arr.filter(v=>v!==0); while(arr.length<4) arr.push(0); return {line:arr, gain:scoreGain}; }
function move(dir){
  const before=board.slice(); prevState={board:before.slice(), score:scoreNow}; let totalGain=0;
  if(dir==='L'||dir==='R'){ for(let r=0;r<4;r++){ let row=board.slice(r*4,r*4+4); if(dir==='R') row.reverse(); const {line,gain}=lineMove(row); totalGain+=gain; if(dir==='R') line.reverse(); for(let c=0;c<4;c++) board[r*4+c]=line[c]; } }
  else { for(let c=0;c<4;c++){ let col=[board[c],board[c+4],board[c+8],board[c+12]]; if(dir==='D') col.reverse(); const {line,gain}=lineMove(col); totalGain+=gain; if(dir==='D') line.reverse(); [board[c],board[c+4],board[c+8],board[c+12]]=line; } }
  if(board.join('')===before.join('')){ prevState=null; return; }
  scoreNow+=totalGain; if(scoreNow>best){ best=scoreNow; localStorage.setItem('scoop_best', String(best)); }
  spawn(); draw(); checkState();
}
function checkState(){ const maxTile=Math.max(...board); if(maxTile>=2048){ scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ‰ 2048é”æˆï¼${IMAGE_LABEL[2048]||''}</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`; }
  else scResult.style.display='none';
  if(!canMove()){ scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã‚¹ã‚³ã‚¢ ${scoreNow}ï¼ˆãƒ™ã‚¹ãƒˆ ${best}ï¼‰ ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`; } }
function draw(){
  scTiles.innerHTML='';
  for(let i=0;i<16;i++){
    const slot=document.createElement('div'); slot.className='slot';
    const v=board[i]; if(v){ const t=document.createElement('div'); t.className=`tile t${v}`;
      if(v>=128){ const img=document.createElement('img'); img.className='tileImg'; img.src=`puzzle${v}.png`; img.alt=IMAGE_LABEL[v]||String(v);
        img.addEventListener('error',()=>{ img.remove(); t.innerHTML=`<b>${v}</b>`; }); t.appendChild(img);
      } else { t.innerHTML=`<b>${v}</b>`; }
      slot.appendChild(t);
    }
    scTiles.appendChild(slot);
  }
  scScore.textContent=`ã‚¹ã‚³ã‚¢: ${scoreNow}`; scBest.textContent=`ãƒ™ã‚¹ãƒˆ: ${best}`;
}
window.addEventListener('keydown', (e)=>{ if(scoopView.style.display!=='block') return; const k=e.key;
  if(k==='ArrowLeft') move('L'); else if(k==='ArrowRight') move('R'); else if(k==='ArrowUp') move('U'); else if(k==='ArrowDown') move('D'); });
let touchStartX=0,touchStartY=0; scTiles.addEventListener('touchstart',(e)=>{const t=e.touches[0];touchStartX=t.clientX;touchStartY=t.clientY;},{passive:true});
scTiles.addEventListener('touchend',(e)=>{const t=e.changedTouches[0];const dx=t.clientX-touchStartX, dy=t.clientY-touchStartY; const ax=Math.abs(dx), ay=Math.abs(dy), TH=24; if(ax<TH && ay<TH) return; if(ax>ay) move(dx>0?'R':'L'); else move(dy>0?'D':'U');},{passive:true});
document.querySelector('#scPad .up').addEventListener('click', ()=>move('U'));
document.querySelector('#scPad .down').addEventListener('click', ()=>move('D'));
document.querySelector('#scPad .left').addEventListener('click', ()=>move('L'));
document.querySelector('#scPad .right').addEventListener('click', ()=>move('R'));
scUndo.addEventListener('click', ()=>{ if(!prevState) return; board=prevState.board.slice(); scoreNow=prevState.score; prevState=null; draw(); scResult.style.display='none'; });
scRetry.addEventListener('click', setupScoop);

/* =================================================
   2äººãƒ—ãƒ¬ã‚¤ï¼šäº¤äº’ã«ã‚­ãƒ£ãƒ©é¸æŠ â†’ ã‚²ãƒ¼ãƒ é¸æŠ
   ================================================= */
const vsRoster=document.getElementById('vsRoster'), vsTurnPill=document.getElementById('vsTurnPill');
const CHAR=[ {id:1,name:'åº—é•·',img:'character1.png',coin:'coin1.png'},
             {id:2,name:'å¥¥ã•ã‚“',img:'character2.png',coin:'coin2.png'},
             {id:3,name:'ãƒã‚¤ãƒˆ',img:'character3.png',coin:'coin3.png'},
             {id:4,name:'ç¤¾é•·',img:'character4.png',coin:'coin4.png'} ];
let VS={p1:null,p2:null};
function showVersus(){ [titleView,gameView,memView,scoopView,vsGameMenu,ticView,c4View].forEach(v=>v.style.display='none'); VS={p1:null,p2:null}; vsTurnPill.textContent='P1 ã‚’é¸ã‚“ã§ã­'; vsView.style.display='block'; renderRoster(); window.scrollTo({top:0,behavior:'smooth'}); }
function renderRoster(){
  vsRoster.innerHTML='';
  CHAR.forEach(ch=>{
    const card=document.createElement('div'); card.className='charCard';
    if (VS.p1 && VS.p1.id===ch.id) card.classList.add('disabled'); // åŒã‚­ãƒ£ãƒ©ã¯é™ã‹ã«ä¸å¯
    const img=document.createElement('img'); img.src=ch.img; img.alt=ch.name;
    const cap=document.createElement('div'); cap.className='charName'; cap.textContent=ch.name;
    card.append(img,cap);
    card.addEventListener('click',()=>{
      if(!VS.p1){ VS.p1=ch; vsTurnPill.textContent='P2 ã‚’é¸ã‚“ã§ã­'; renderRoster(); return; }
      if(!VS.p2){ if(VS.p1.id===ch.id) return; VS.p2=ch; showVsGameMenu(); }
    });
    vsRoster.appendChild(card);
  });
}
function showVsGameMenu(){ vsView.style.display='none'; vsGameMenu.style.display='block'; }
document.getElementById('vsBack').addEventListener('click', showTitle);
document.getElementById('vsGameBack').addEventListener('click', showVersus);
document.getElementById('vsGameToTitle').addEventListener('click', showTitle);

/* =================================================
   â—¯âœ•ã‚²ãƒ¼ãƒ ï¼ˆ2äººï¼‰ å…ˆæ”»/å¾Œæ”»ãƒ©ãƒ³ãƒ€ãƒ ãƒ»èµ¤æ ã§ã‚¿ãƒ¼ãƒ³è¡¨ç¤º
   ================================================= */
const ticGrid=document.getElementById('ticGrid'), ticTurn=document.getElementById('ticTurn'), ticResult=document.getElementById('ticResult');
const ticP1pic=document.getElementById('ticP1pic'), ticP2pic=document.getElementById('ticP2pic');
const ticP1name=document.getElementById('ticP1name'), ticP2name=document.getElementById('ticP2name');
const ticP1say=document.getElementById('ticP1say'), ticP2say=document.getElementById('ticP2say');
const ticBadge1=document.getElementById('ticP1'), ticBadge2=document.getElementById('ticP2');
let ticBoard, ticTurnNum, ticOver=false;
const LINES={1:{win:'ä¿ºã«å‹ã¨ã†ãªã‚“ã¦100å¹´æ—©ã„ï¼',lose:'ã„ã‚„ãƒ¼ã‚“ï¼'},
             2:{win:'ç§ãŒ1ç•ªã‚ˆï¼',lose:'ã‚ã‚“ãŸæ¸›çµ¦ã­â€¦'},
             3:{win:'ã‚„ã£ãŸã£ã™ï¼',lose:'ãƒã‚¸ã‹â€¦'},
             4:{win:'ãµãµã€å½“ç„¶ã ã­',lose:'æ¬¡ã¯å‹ã¤ã‚ˆ'}};
function startTicTacToe(V){
  [titleView,gameView,memView,scoopView,vsView,vsGameMenu,c4View].forEach(v=>v.style.display='none'); ticView.style.display='block';
  // VSã‚’ä¿æŒ
  window._VS = V;
  ticP1pic.src=V.p1.img; ticP2pic.src=V.p2.img; ticP1name.textContent=V.p1.name; ticP2name.textContent=V.p2.name;
  ticBoard=new Array(9).fill(null);
  ticGrid.innerHTML=''; for(let i=0;i<9;i++){ const c=document.createElement('div'); c.className='ticCell'; c.dataset.i=i; c.addEventListener('click',()=>ticClick(i,c)); ticGrid.appendChild(c); }
  ticOver=false;
  // å…ˆæ”»ãƒ©ãƒ³ãƒ€ãƒ 
  ticTurnNum = Math.random()<0.5 ? 1 : 2; updateTicHud();
  ticResult.style.display='none';
  window.scrollTo({top:0,behavior:'smooth'});
}
function updateTicHud(){
  ticTurn.textContent = `P${ticTurnNum}ã®ã‚¿ãƒ¼ãƒ³`;
  ticBadge1.classList.toggle('turnRing', ticTurnNum===1);
  ticBadge2.classList.toggle('turnRing', ticTurnNum===2);
}
function ticClick(i,cell){
  if(ticOver || ticBoard[i]) return;
  ticBoard[i] = (ticTurnNum===1?'X':'O');
  cell.textContent = ticBoard[i]; cell.classList.add('mark');
  // å‹æ•—åˆ¤å®š
  const w = ticWinner();
  if(w){ finishTic(w); return; }
  if(!ticBoard.includes(null)){ ticResult.style.display='block'; ticResult.innerHTML=`<strong>ğŸ¤ å¼•ãåˆ†ã‘ï¼</strong>`; ticOver=true; return; }
  ticTurnNum = ticTurnNum===1?2:1; updateTicHud();
}
function ticWinner(){
  const b=ticBoard, L=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(const [a,c,d] of L){ if(b[a] && b[a]===b[c] && b[a]===b[d]) return (b[a]==='X'?1:2); }
  return 0;
}
function finishTic(winner){
  ticOver=true; const loser = winner===1?2:1;
  ticResult.style.display='block'; ticResult.innerHTML=`<strong>ğŸ‰ P${winner}ã®å‹ã¡ï¼</strong>`;
  // ã‚»ãƒªãƒ•
  const idW = window._VS[winner===1?'p1':'p2'].id, idL = window._VS[loser===1?'p1':'p2'].id;
  ticP1say.textContent = (winner===1? LINES[idW].win : LINES[idL].lose );
  ticP2say.textContent = (winner===2? LINES[idW].win : LINES[idL].lose );
}
document.getElementById('ticRetry').addEventListener('click', ()=>startTicTacToe(window._VS));
document.getElementById('ticOther').addEventListener('click', ()=>{ ticView.style.display='none'; vsGameMenu.style.display='block'; });
document.getElementById('ticBack').addEventListener('click', showTitle);

/* =================================================
   å››ç›®ä¸¦ã¹ï¼ˆ2äººï¼‰ ç°¡æ˜“è½ä¸‹ã‚¢ãƒ‹ãƒ¡
   ================================================= */
const c4GridEl=document.getElementById('c4Grid'), c4Pointers=document.getElementById('c4Pointers'), c4TurnEl=document.getElementById('c4Turn'), c4Result=document.getElementById('c4Result');
const c4P1pic=document.getElementById('c4P1pic'), c4P2pic=document.getElementById('c4P2pic');
const c4P1name=document.getElementById('c4P1name'), c4P2name=document.getElementById('c4P2name');
const c4Badge1=document.getElementById('c4P1'), c4Badge2=document.getElementById('c4P2');
let C4, c4TurnNum, c4Over=false;
function startConnect4(V){
  [titleView,gameView,memView,scoopView,vsView,vsGameMenu,ticView].forEach(v=>v.style.display='none'); c4View.style.display='block';
  window._VS=V; C4={cols:7,rows:6,board:Array.from({length:6},()=>Array(7).fill(0))};
  c4P1pic.src=V.p1.img; c4P2pic.src=V.p2.img; c4P1name.textContent=V.p1.name; c4P2name.textContent=V.p2.name;
  c4GridEl.innerHTML=''; for(let r=0;r<C4.rows;r++)for(let c=0;c<C4.cols;c++){ const cell=document.createElement('div'); cell.className='c4Cell'; cell.dataset.r=r; cell.dataset.c=c; c4GridEl.appendChild(cell); }
  c4Pointers.innerHTML=''; for(let c=0;c<C4.cols;c++){ const b=document.createElement('button'); b.addEventListener('click',()=>c4Drop(c)); c4Pointers.appendChild(b); }
  c4Over=false; c4TurnNum = Math.random()<0.5?1:2; updateC4Hud();
  c4Result.style.display='none'; window.scrollTo({top:0,behavior:'smooth'});
}
function updateC4Hud(){
  c4TurnEl.textContent=`P${c4TurnNum}ã®ã‚¿ãƒ¼ãƒ³`;
  c4Badge1.classList.toggle('turnRing', c4TurnNum===1);
  c4Badge2.classList.toggle('turnRing', c4TurnNum===2);
}
function c4Drop(col){
  if(c4Over) return;
  // æœ€ä¸‹æ®µã®ç©ºãã‚’æ¢ã™
  let row=-1; for(let r=C4.rows-1;r>=0;r--){ if(C4.board[r][col]===0){ row=r; break; } }
  if(row===-1) return; // ã„ã£ã±ã„
  const pid=c4TurnNum;
  C4.board[row][col]=pid;
  // è¦‹ãŸç›®ï¼šè½ä¸‹ã‚¢ãƒ‹ãƒ¡ï¼ˆã‚»ãƒ«å†…ã‹ã‚‰ä¸Šæ–¹å‘â†’0ã¸ï¼‰
  const cell=[...c4GridEl.children][row*C4.cols+col];
  const img=document.createElement('img'); img.className='chip'; img.style.setProperty('--r', (row+1)); img.src = pid===1? window._VS.p1.coin : window._VS.p2.coin; img.alt='coin';
  cell.appendChild(img);

  // åˆ¤å®š
  if (c4WinAt(row,col,pid)){ finishC4(pid); return; }
  if (C4.board.every(r=>r.every(v=>v!==0))){ c4Result.style.display='block'; c4Result.innerHTML='<strong>ğŸ¤ å¼•ãåˆ†ã‘ï¼</strong>'; c4Over=true; return; }
  c4TurnNum = c4TurnNum===1?2:1; updateC4Hud();
}
function c4WinAt(r,c,p){
  const dirs=[[1,0],[0,1],[1,1],[1,-1]];
  for(const [dr,dc] of dirs){
    let cnt=1;
    for(let s=1;s<4;s++){ const nr=r+dr*s, nc=c+dc*s; if(nr<0||nr>=C4.rows||nc<0||nc>=C4.cols) break; if(C4.board[nr][nc]===p) cnt++; else break; }
    for(let s=1;s<4;s++){ const nr=r-dr*s, nc=c-dc*s; if(nr<0||nr>=C4.rows||nc<0||nc>=C4.cols) break; if(C4.board[nr][nc]===p) cnt++; else break; }
    if(cnt>=4) return true;
  }
  return false;
}
function finishC4(winner){
  c4Over=true; c4Result.style.display='block'; c4Result.innerHTML=`<strong>ğŸ‰ P${winner}ã®å‹ã¡ï¼</strong>`;
}
document.getElementById('c4Retry').addEventListener('click', ()=>startConnect4(window._VS));
document.getElementById('c4Other').addEventListener('click', ()=>{ c4View.style.display='none'; vsGameMenu.style.display='block'; });
document.getElementById('c4Back').addEventListener('click', showTitle);

/* 2äººãƒ¡ãƒ‹ãƒ¥ãƒ¼é·ç§»ãƒœã‚¿ãƒ³ */
document.getElementById('goTic').addEventListener('click', ()=>startTicTacToe(VS));
document.getElementById('goConnect4').addEventListener('click', ()=>startConnect4(VS));

</script>
</body>
</html>
