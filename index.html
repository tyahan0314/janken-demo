<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </title>

<!-- =========================
     ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»è‰²ï¼‰
     ========================= -->
<style>
  :root{
    --bg:#97d2e4; --ink:#0c2a33; --muted:#215b6b; --white:#fff;
    --pill:#e6f7fd; --btn:#10aee3; --btn-ink:#fff; --card:#ffffffef;
    --win:#0da66e; --lose:#d94848; --accent:#e53935;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif
  }
  .wrap{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
  .container{width:min(880px,92vw);margin:0 auto;padding:16px 0 24px}

  /* å…±é€šè¦‹å‡ºã— */
  h1{margin:8px 0 4px;font-size:clamp(22px,5.8vw,36px);letter-spacing:.06em;text-align:center}
  .sub{margin:0 0 10px;color:var(--muted);text-align:center;font-size:clamp(12px,3.4vw,15px)}
  .score{margin:12px 0 6px;text-align:center;font-weight:800;font-size:clamp(22px,7.2vw,34px)}
  .message{margin:8px 0 18px;text-align:center;font-size:clamp(14px,4.2vw,18px)}

  /* ãƒœã‚¿ãƒ³ç³» */
  .pill{display:inline-block;padding:.45em 1em;border-radius:999px;background:var(--pill);
    font-weight:700;color:#222;font-size:clamp(12px,3.8vw,16px)}
  .btnrow{display:flex;gap:14px;justify-content:center;align-items:center;margin:10px 0 0;position:relative;z-index:5;flex-wrap:wrap}
  .btn{appearance:none;border:none;border-radius:14px;cursor:pointer;font-weight:800;letter-spacing:.06em}
  .btn.primary{background:var(--btn);color:var(--btn-ink);padding:14px 22px;font-size:clamp(14px,4.8vw,18px)}
  .btn.ghost{background:transparent;color:#083b48;border:2px solid #083b4840;
    padding:12px 20px;border-radius:16px;font-size:clamp(14px,4.8vw,18px)}
  .btn:disabled{opacity:.45;cursor:not-allowed}

  /* ===== ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ ===== */
  #title{display:grid;place-items:center}
  #title .hero{width:100%;display:flex;flex-direction:column;align-items:center;gap:12px;margin-top:8px}
  #title h2{margin:0;text-align:center;line-height:1.25;font-size:clamp(22px,6.2vw,34px)}
  .title-illus{
    width:min(620px,92vw);max-height:62svh;object-fit:contain;object-position:center bottom;
    display:block;margin:8px auto 2px; pointer-events:none;
  }
  .title-note{margin:12px 0 0;text-align:center;color:#083b48aa;font-size:clamp(12px,3.6vw,15px)}
  .speech{display:none;margin:2px auto 0;padding:.6em 1em;border-radius:12px;
    background:#fff; box-shadow:0 8px 24px rgba(0,0,0,.12); font-weight:800; text-align:center}

  /* ===== ã˜ã‚ƒã‚“ã‘ã‚“ ===== */
  #game{display:none}
  .topRow{
    margin-top:4px;display:flex;align-items:flex-start;justify-content:space-between;gap:clamp(10px,4vw,18px)
  }
  .frameBox{
    position:relative;flex:0 0 auto;
    width:clamp(160px,40vw,320px);aspect-ratio:3/4;
    background:url("frame2.png") center/contain no-repeat;
  }
  .bossHandImg{
    position:absolute;left:8%;top:6%;width:84%;height:88%;
    object-fit:contain;filter:drop-shadow(0 10px 16px #00000018);
  }
  .bossPic{
    flex:0 0 auto;width:clamp(200px,42vw,360px);height:auto;object-fit:contain;
    filter:drop-shadow(0 10px 20px rgba(0,0,0,.12))
  }
  .hands{margin:16px auto 0;display:flex;justify-content:center;gap:clamp(12px,4vw,18px)}
  .handBtn{
    width:clamp(92px,22vw,136px);aspect-ratio:1/1;border-radius:18px;background:var(--white);
    box-shadow:0 10px 30px #075a6a22;display:grid;place-items:center;
    font-size:clamp(34px,10vw,52px);cursor:pointer;border:none
  }
  .resultCard{display:none;margin:12px auto 0;max-width:720px;background:var(--card);
    border-radius:16px;padding:12px 14px;text-align:center;font-size:clamp(14px,4.4vw,18px);box-shadow:0 12px 28px #07495926}
  .restartRow{display:none;justify-content:center;margin:14px 0 0}
  .win{color:var(--win);font-weight:800}.lose{color:var(--lose);font-weight:800}

  /* ===== ç¥çµŒè¡°å¼±ï¼ˆæ­£æ–¹å½¢ã‚«ãƒ¼ãƒ‰ï¼‰ ===== */
  #memory{display:none}
  .memDiff{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin: 6px 0 6px; }
  .memHud{
    display:flex; gap:14px; justify-content:center; align-items:center;
    margin: 10px 0 10px; font-weight:700; flex-wrap:wrap;
  }
  .memGrid{
    --gap: clamp(10px, 3.4vw, 14px);
    display:grid; gap: var(--gap);
    grid-template-columns: repeat(4, 1fr); /* 8æš=2è¡Œã€12æš=3è¡Œ */
    width:min(740px, 92vw); margin: 0 auto;
  }
  .memCard{ aspect-ratio: 1 / 1; perspective: 1000px; position:relative; }
  .memInner{
    position:absolute; inset:0; transition: transform .42s ease;
    transform-style: preserve-3d; transform: rotateY(180deg);
  }
  .memInner.flipped{ transform: rotateY(0deg); }
  .memFace{
    position:absolute; inset:0; border-radius:16px; overflow:hidden;
    backface-visibility:hidden; box-shadow:0 10px 24px rgba(0,0,0,.12);
    display:grid; place-items:center;
  }
  .memFace.front{ background:#fff; transform: rotateY(0deg); }
  .memFace.back{
    background: linear-gradient(135deg, #c9f0ff, #97d2e4);
    color:#084357; font-size: clamp(22px, 6.4vw, 28px);
    transform: rotateY(180deg);
  }
  .memFace.front img{ width: 78%; height: 78%; object-fit: contain; pointer-events:none; }
  .memInner.matched{ animation: pop .36s ease; }
  @keyframes pop{ 0%{ transform: rotateY(0deg) scale(1)} 50%{ transform: rotateY(0deg) scale(1.06)} 100%{ transform: rotateY(0deg) scale(1)} }
  .lives{ display:flex; gap:6px; align-items:center; font-size:clamp(18px,5.4vw,22px) }
  .lives .heart{ transition: .2s ease; }
  .lives .heart.lost{ opacity:.3; filter:grayscale(1); transform:scale(.92); }

  /* ===== 2048ï¼ˆã‚¢ã‚¤ã‚¹åˆæˆãƒ‘ã‚ºãƒ«ï¼‰ ===== */
  #scoop{display:none}
  .scoopHud{display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
  .scoopHud span{background:#ffffffcc;padding:8px 12px;border-radius:10px;box-shadow:0 6px 16px #00000012}
  .scoopBtns{display:flex;gap:10px}
  .scoopBoard{width:min(520px,92vw);margin:12px auto 0;position:relative}
  .scGrid{
    display:grid;grid-template-columns:repeat(4,1fr);gap:10px;
    background:#bde3ef;padding:10px;border-radius:14px;
  }
  .scGrid .cell{aspect-ratio:1/1;border-radius:10px;background:#e6f7fd}
  .scTiles{position:absolute;inset:0;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px}
  .scTiles > .slot{ aspect-ratio: 1 / 1; }
  .tile{
    width:100%; height:100%; border-radius:12px;display:grid;place-items:center;
    font-weight:900;text-align:center;line-height:1.1;
    box-shadow:0 10px 24px rgba(0,0,0,.12); user-select:none;
    animation: tileIn .18s ease; color:#083b48;font-size:clamp(12px,3.6vw,15px)
  }
  .tile b{display:block;font-size:clamp(18px,6vw,26px)}
  @keyframes tileIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
  .tile.merge{animation: mergePop .22s ease}
  @keyframes mergePop{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  .t2{background:#fffdf5}.t4{background:#fff6da}
  .t8{background:#ffe1e9}.t16{background:#f6d7c7}
  .t32{background:#d8f0dc}.t64{background:#d7f0fb}
  .t128{background:#ffe9c2}.t256{background:#f7d9ff}
  .t512{background:#d9fff1}.t1024{background:#fff0c5}.t2048{background:#ffe7e7}
  .tileImg{ width:86%; height:86%; object-fit:contain; pointer-events:none; }
  #scPad{ position:sticky; bottom:env(safe-area-inset-bottom, 12px); display:none; margin-top:16px; }
  .pad{ width:180px; height:160px; margin:0 auto; position:relative; display:grid; place-items:center; }
  .pad button{ position:absolute; width:56px; height:56px; border-radius:50%;
    border:none; background:#ffffffd8; box-shadow:0 8px 18px #00000018; font-size:22px; font-weight:900; color:#0c2a33; cursor:pointer; }
  .pad .up{top:0; left:50%; transform:translate(-50%,0)}
  .pad .down{bottom:0; left:50%; transform:translate(-50%,0)}
  .pad .left{left:0; top:50%; transform:translate(0,-50%)}
  .pad .right{right:0; top:50%; transform:translate(0,-50%)}

  /* ===== 2äººã§éŠã¶ï¼šã‚­ãƒ£ãƒ©é¸æŠ ===== */
  #duoSelect{display:none}
  .charGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;width:min(740px,92vw);margin:10px auto 0}
  .charCard{position:relative;background:#fff;border-radius:16px;box-shadow:0 10px 20px #00000018;padding:10px;display:grid;place-items:center;cursor:pointer}
  .charCard img{width:100%;height:auto;object-fit:contain;border-radius:12px}
  .charLabel{margin-top:6px;font-weight:800}
  .charCard .badge{position:absolute;top:8px;left:8px;background:#00000080;color:#fff;font-size:12px;border-radius:999px;padding:.2em .6em;display:none}
  .charCard.selectedP1::after,
  .charCard.selectedP2::after{
    content:attr(data-select-label);
    position:absolute;top:8px;left:8px;background:#10aee3;color:#fff;padding:.25em .6em;border-radius:999px;font-size:12px;font-weight:800
  }
  .selectHint{margin:6px 0 0;text-align:center;font-weight:800}

  /* ===== 2äººå¯¾æˆ¦ï¼ˆâ—¯âœ–ï¼‰ ===== */
  #duoMenu{display:none}
  #ttt{display:none}
  .pHud{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;margin:8px 0 12px}
  .pCard{display:flex;align-items:center;gap:10px;background:#ffffffcc;border:3px solid transparent;border-radius:16px;padding:8px 12px;box-shadow:0 8px 18px #00000014;min-width:clamp(160px,40vw,280px)}
  .pIcon{width:64px;height:64px;border-radius:50%;object-fit:cover;background:#fff}
  .pName{font-weight:900}
  .pLine{font-size:13px;color:#083b48; margin-top:2px}
  .pCard.active{ border-color:var(--accent); box-shadow:0 0 0 4px #e5393526; }
  .turnLabel{font-weight:900;margin:0 auto}

  /* ç›¤ï¼šèƒŒæ™¯ã‚¹ãƒ†ãƒ¼ã‚¸ + å®Ÿãƒã‚¹ */
  .tttStage{ 
    background:url("stage3x3.png") center/contain no-repeat;
    padding:14px;border-radius:20px; 
    box-shadow:0 12px 28px #07495926;
    width:min(560px,92vw); margin:0 auto;
  }
  .tttBoard{
    display:grid;grid-template-columns:repeat(3,1fr);gap:12px
  }
  .cell{
    aspect-ratio:1/1;border-radius:14px;background:#e6f7fd;display:grid;place-items:center;
    font-weight:900;font-size:clamp(28px,10vw,56px);color:#083b48;cursor:pointer;
    box-shadow:inset 0 0 0 2px #083b4814;
  }
  .cell.disabled{pointer-events:none;opacity:.65}
  .bubble{display:none;margin:10px auto 0;max-width:720px;background:#fff;border-radius:14px;padding:10px 12px;box-shadow:0 12px 28px #07495926;text-align:center;font-weight:800}
</style>
</head>

<body>
<div class="wrap">

  <!-- ============= ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ ============= -->
  <div class="container" id="title">
    <div class="hero">
      <span class="pill" id="titlePill">ã‚ã¡ã‚ƒã¤ã‚ˆã£ï¼</span>
      <h2>ãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ã¨ã®<br>ã˜ã‚ƒã‚“ã‘ã‚“å¯¾æ±ºï¼</h2>

      <img id="titleImg" class="title-illus" src="title-start2.png" alt="åº—é•·ãƒãƒ¼ã‚º">
      <div id="speech" class="speech">ä¿ºã®å¼·ã•ã«æ€–æ°—ã¥ã„ãŸã‹ã£ï¼</div>

      <div class="btnrow">
        <button class="btn primary" id="btnStart">æŒ‘æˆ¦ã™ã‚‹</button>
        <button class="btn ghost"   id="btnQuit"  data-mode="quit">ã‚ãã‚‰ã‚ã‚‹</button>
      </div>

      <div class="btnrow">
        <button class="btn ghost" id="btnMem">ç¥çµŒè¡°å¼±ã§éŠã¶</button>
      </div>
      <div class="btnrow">
        <button class="btn ghost" id="btnScoop">åˆæˆãƒ‘ã‚ºãƒ«ã§éŠã¶</button>
      </div>
      <div class="btnrow">
        <button class="btn ghost" id="btnDuo">2äººã§éŠã¶</button>
      </div>

      <p class="title-note">ã‚ã¡ã‚ƒã¤ã‚ˆåº—é•·ã«å‹åˆ©ã—ã‚ˆã†ï¼</p>
    </div>
  </div>

  <!-- ============= ã˜ã‚ƒã‚“ã‘ã‚“ ============= -->
  <div class="container" id="game">
    <div class="topRow">
      <div class="frameBox">
        <img id="bossHandImg" class="bossHandImg" src="rock2.png" alt="åº—é•·ã®æ‰‹">
      </div>
      <img class="bossPic" src="boss2.png" alt="åº—é•·">
    </div>

    <h1>ï½åº—é•·ã¨ã‚¸ãƒ£ãƒ³ã‚±ãƒ³å‹è² ï½</h1>
    <p class="sub">å…ˆã«3å›å‹ã£ãŸæ–¹ãŒå‹ã¡ï¼</p>

    <div class="score" id="score">ã‚ãªãŸ 0 - åº—é•· 0</div>
    <div class="message" id="message">æ‰‹ã‚’é¸ã‚“ã§ã­ï¼</div>

    <div class="hands" id="hands">
      <button class="handBtn" data-hand="rock"     aria-label="ã‚°ãƒ¼">âœŠ</button>
      <button class="handBtn" data-hand="scissors" aria-label="ãƒãƒ§ã‚­">âœŒï¸</button>
      <button class="handBtn" data-hand="paper"    aria-label="ãƒ‘ãƒ¼">âœ‹</button>
    </div>

    <div class="resultCard" id="resultCard"></div>
    <div class="restartRow" id="restartRow">
      <button class="btn ghost" id="restartBtn">å†æŒ‘æˆ¦</button>
    </div>

    <div class="btnrow" style="margin-top:12px">
      <button class="btn ghost" id="backToTitle1">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= ç¥çµŒè¡°å¼± ============= -->
  <div class="container" id="memory">
    <h1>ã€œç¥çµŒè¡°å¼±ã€œ</h1>
    <p class="sub">åŒã˜ã‚¢ã‚¤ã‚¹ã‚’2æšã‚ãã£ã¦ãƒšã‚¢ã‚’ä½œã‚ã†ï¼</p>

    <div class="memDiff">
      <button class="btn primary" id="memEasyBtn">ã‚„ã•ã—ã„ï¼ˆ4ãƒšã‚¢ï¼‰</button>
      <button class="btn ghost"   id="memHardBtn">ã‚€ãšã‹ã—ã„ï¼ˆ6ãƒšã‚¢ï¼‰</button>
    </div>

    <div class="memHud" id="memHud" style="display:none">
      <span id="memMoves">æ‰‹æ•°: 0</span>
      <span id="memPairs">ãƒšã‚¢: 0 / 4</span>
      <span class="lives" id="memLives" title="ãƒ©ã‚¤ãƒ•">
        <span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span>
      </span>
      <button class="btn ghost" id="memRetry">ã‚‚ã†ä¸€å›</button>
    </div>

    <div class="memGrid" id="memGrid" aria-label="ã‚«ãƒ¼ãƒ‰ã®å ´"></div>
    <div class="resultCard" id="memResult" style="display:none; margin-top:14px"></div>

    <div class="btnrow" style="margin-top:10px">
      <button class="btn ghost" id="memBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= 2048 ============= -->
  <div class="container" id="scoop">
    <h1>ã€œ2048ãƒ‘ã‚ºãƒ«ã€œ</h1>
    <p class="sub">åŒã˜æ•°å­—ã‚’åˆä½“ã•ã›ã¦é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†</p>

    <div class="scoopHud">
      <span id="scScore">ã‚¹ã‚³ã‚¢: 0</span>
      <span id="scBest">ãƒ™ã‚¹ãƒˆ: 0</span>
      <div class="scoopBtns">
        <button class="btn ghost" id="scUndo">1æ‰‹æˆ»ã‚‹</button>
        <button class="btn ghost" id="scRetry">ã‚‚ã†ä¸€å›</button>
      </div>
    </div>

    <div class="scoopBoard">
      <div class="scGrid" id="scGridBg"></div>
      <div class="scTiles" id="scTiles"></div>
    </div>

    <div class="resultCard" id="scResult" style="display:none; margin-top:14px"></div>

    <div id="scPad">
      <div class="pad">
        <button class="up"    aria-label="ä¸Šã¸">â†‘</button>
        <button class="left"  aria-label="å·¦ã¸">â†</button>
        <button class="right" aria-label="å³ã¸">â†’</button>
        <button class="down"  aria-label="ä¸‹ã¸">â†“</button>
      </div>
    </div>

    <div class="btnrow" style="margin-top:10px">
      <button class="btn ghost" id="scBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= 2äººã§éŠã¶ï¼šã‚­ãƒ£ãƒ©é¸æŠ ============= -->
  <div class="container" id="duoSelect">
    <h1>2äººã§éŠã¶</h1>
    <p class="sub" id="selectWho">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­ï¼ˆåŒã˜ã‚­ãƒ£ãƒ©ã¯<em>åº—é•·ã ã‘OK</em>ï¼‰</p>
    <div class="selectHint" id="selectHint">P1 â†’ P2 ã®é †ã«ã‚¿ãƒƒãƒ—ã§é¸æŠ</div>

    <div class="charGrid" id="charGrid"></div>

    <div class="btnrow">
      <button class="btn primary" id="toDuoMenu" disabled>ã‚²ãƒ¼ãƒ ã‚’é¸ã¶</button>
      <button class="btn ghost" id="selBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= 2äººã§éŠã¶ï¼šã‚²ãƒ¼ãƒ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ ============= -->
  <div class="container" id="duoMenu">
    <h1>2äººå¯¾æˆ¦ã§éŠã¶ã‚²ãƒ¼ãƒ </h1>
    <div class="btnrow">
      <button class="btn primary" id="playTTT">â—¯âœ–ï¼ˆãƒãƒ«ãƒãƒ„ï¼‰</button>
      <!-- å°†æ¥ç”¨ï¼šç¥çµŒè¡°å¼±7ç¨®ï¼å››ç›®ä¸¦ã¹ã‚’ã“ã“ã«è¿½åŠ  -->
    </div>
    <div class="btnrow">
      <button class="btn ghost" id="duoBackToSelect">ã‚­ãƒ£ãƒ©é¸ã³ã«æˆ»ã‚‹</button>
      <button class="btn ghost" id="duoBackToTitle">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ============= 2äººå¯¾æˆ¦ï¼šâ—¯âœ–ã‚²ãƒ¼ãƒ æœ¬ä½“ ============= -->
  <div class="container" id="ttt">
    <h1>ã€œâ—¯âœ– ã‚²ãƒ¼ãƒ ã€œ</h1>

    <div class="pHud">
      <div class="pCard" id="p1Card">
        <img class="pIcon" id="p1Icon" alt="">
        <div>
          <div class="pName" id="p1Name">P1</div>
          <div class="pLine" id="p1Line"></div>
        </div>
      </div>

      <div class="turnLabel" id="turnLabel">P1ã®ã‚¿ãƒ¼ãƒ³</div>

      <div class="pCard" id="p2Card">
        <img class="pIcon" id="p2Icon" alt="">
        <div>
          <div class="pName" id="p2Name">P2</div>
          <div class="pLine" id="p2Line"></div>
        </div>
      </div>
    </div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¸èƒŒæ™¯ä»˜ãã®ç›¤ãƒ©ãƒƒãƒ‘ -->
    <div class="tttStage">
      <div class="tttBoard" id="tttBoard"></div>
    </div>

    <div class="bubble" id="tttBubble"></div>

    <div class="btnrow" style="margin-top:12px">
      <button class="btn primary" id="tttRetry" style="display:none">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="tttToMenu" style="display:none">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
      <button class="btn ghost" id="tttBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

</div><!-- /.wrap -->

<!-- =========================
     ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæŒ™å‹•ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
     ========================= -->
<script>
  /* ---------- ç”»é¢å‚ç…§ ---------- */
  const titleView = document.getElementById('title');
  const gameView  = document.getElementById('game');
  const memView   = document.getElementById('memory');
  const scoopView = document.getElementById('scoop');
  const duoSelect = document.getElementById('duoSelect');
  const duoMenu   = document.getElementById('duoMenu');
  const tttView   = document.getElementById('ttt');

  /* ---------- ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒœã‚¿ãƒ³ ---------- */
  const titleImg  = document.getElementById('titleImg');
  const speech    = document.getElementById('speech');
  const btnStart  = document.getElementById('btnStart');
  const btnQuit   = document.getElementById('btnQuit');
  const btnMem    = document.getElementById('btnMem');
  const btnScoop  = document.getElementById('btnScoop');
  const btnDuo    = document.getElementById('btnDuo');

  btnQuit.addEventListener('click', () => {
    if (btnQuit.dataset.mode === 'quit') {
      speech.style.display = 'block';
      titleImg.src = 'title-quit2.png';
      btnQuit.textContent = 'æŒ‘æˆ¦ã™ã‚‹';
      btnQuit.dataset.mode = 'start';
      btnQuit.classList.remove('ghost');
      btnQuit.classList.add('primary');
    } else {
      startGame();
    }
  });
  btnStart.addEventListener('click', startGame);
  btnMem.addEventListener('click', showMemoryMenu);
  btnScoop.addEventListener('click', showScoop);
  btnDuo.addEventListener('click', showDuoSelect);

  function showTitle(){
    gameView.style.display='none';
    memView.style.display='none';
    scoopView.style.display='none';
    duoSelect.style.display='none';
    duoMenu.style.display='none';
    tttView.style.display='none';

    titleView.style.display='block';
    speech.style.display='none';
    titleImg.src = 'title-start2.png';
    btnQuit.textContent = 'ã‚ãã‚‰ã‚ã‚‹';
    btnQuit.dataset.mode = 'quit';
    btnQuit.classList.add('ghost');
    btnQuit.classList.remove('primary');
    window.scrollTo({top:0, behavior:'smooth'});
  }

  /* =======================
     ã˜ã‚ƒã‚“ã‘ã‚“ï¼ˆå®Œæˆç‰ˆï¼‰
     ======================= */
  function startGame(){
    titleView.style.display='none';
    gameView.style.display='block';
    memView.style.display='none';
    scoopView.style.display='none';
    duoSelect.style.display='none';
    duoMenu.style.display='none';
    tttView.style.display='none';
    resetGame();
    window.scrollTo({top:0,behavior:'smooth'});
  }

  const WIN_TARGET = 3;
  const BOSS_EDGE  = 0.70; // åº—é•·ã¡ã‚‡ã„å¼·ã‚

  const scoreEl    = document.getElementById('score');
  const messageEl  = document.getElementById('message');
  const handsWrap  = document.getElementById('hands');
  const resultCard = document.getElementById('resultCard');
  const restartRow = document.getElementById('restartRow');
  const bossHandImg= document.getElementById('bossHandImg');

  let score = { you:0, boss:0 };
  const IMG    = { rock:'rock2.png', scissors:'scissors2.png', paper:'paper2.png' };
  const WINMAP = { rock:'scissors', scissors:'paper', paper:'rock' };

  function resetGame(){
    score.you = 0; score.boss = 0;
    updateScore();
    messageEl.textContent = 'æ‰‹ã‚’é¸ã‚“ã§ã­ï¼';
    bossHandImg.src = IMG.rock;
    resultCard.style.display = 'none';
    restartRow.style.display = 'none';
    handsWrap.style.display = 'flex';
  }
  function updateScore(){ scoreEl.textContent = `ã‚ãªãŸ ${score.you} - åº—é•· ${score.boss}`; }

  function bossPick(player){
    const beat = ({rock:'paper', paper:'scissors', scissors:'rock'})[player];
    const lose = WINMAP[player];
    const tie  = player;
    if (Math.random() < BOSS_EDGE) return beat;
    return [lose, tie][Math.random()<0.5 ? 0 : 1];
  }

  function play(player){
    if (handsWrap.style.display === 'none') return;
    const boss = bossPick(player);
    bossHandImg.src = IMG[boss];

    if (player === boss){
      messageEl.textContent = 'ã‚ã„ã“ï¼æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­';
    }else if (WINMAP[player] === boss){
      score.you++; updateScore();
      messageEl.innerHTML = `<span class="win">ã‚ãªãŸã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`;
    }else{
      score.boss++; updateScore();
      messageEl.innerHTML = `<span class="lose">åº—é•·ã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`;
    }
    checkFinish();
  }

  function checkFinish(){
    if (score.you >= WIN_TARGET || score.boss >= WIN_TARGET){
      handsWrap.style.display = 'none';
      resultCard.style.display = 'block';
      restartRow.style.display = 'flex';
      if (score.you >= WIN_TARGET){
        resultCard.innerHTML = `<strong>ğŸ‰ ã‚ãªãŸã®å‹ã¡ï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`;
      }else{
        resultCard.innerHTML = `<strong>ğŸ‘‘ åº—é•·ã®å‹ã¡ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;
      }
    }
  }

  document.querySelectorAll('.handBtn').forEach(b=>b.addEventListener('click', ()=>play(b.dataset.hand)));
  document.getElementById('restartBtn').addEventListener('click', resetGame);
  document.getElementById('backToTitle1').addEventListener('click', showTitle);

  /* =======================
     ç¥çµŒè¡°å¼±ï¼ˆğŸ©µãƒ©ã‚¤ãƒ•3ï¼‹é›£æ˜“åº¦ï¼‰
     ======================= */
  const USE_ICE_IMAGES = true; // iceç”»åƒãŒç„¡ã„æ™‚ã¯çµµæ–‡å­—ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const ICE_SET = [
    { img:'ice1.png', emoji:'ğŸ¨', name:'ãƒ—ãƒ¬ãƒ¼ãƒ³' },
    { img:'ice2.png', emoji:'ğŸ«', name:'ãƒãƒ§ã‚³' },
    { img:'ice3.png', emoji:'ğŸµ', name:'ãã®ãèŒ¶' },
    { img:'ice4.png', emoji:'ğŸ””', name:'ã¡ã‚Šã‚“ã¡ã‚Šã‚“ãã‚“' },
    { img:'ice5.png', emoji:'ğŸ‘¨', name:'åº—é•·1' },
    { img:'ice6.png', emoji:'ğŸ§‘', name:'åº—é•·2' }
  ];

  const memGrid   = document.getElementById('memGrid');
  const memHud    = document.getElementById('memHud');
  const memMoves  = document.getElementById('memMoves');
  const memPairs  = document.getElementById('memPairs');
  const memRetry  = document.getElementById('memRetry');
  const memBack   = document.getElementById('memBack');
  const memResult = document.getElementById('memResult');
  const memLives  = document.getElementById('memLives');
  const memEasyBtn= document.getElementById('memEasyBtn');
  const memHardBtn= document.getElementById('memHardBtn');

  const MAX_LIVES = 3;
  let TYPES_COUNT = 4;
  let memDeck = [];
  let first = null, second = null, lock = false;
  let pairs = 0, moves = 0;
  let lives = MAX_LIVES;
  let memOver = false;

  function showMemoryMenu(){
    titleView.style.display='none';
    gameView.style.display='none';
    scoopView.style.display='none';
    duoSelect.style.display='none';
    duoMenu.style.display='none';
    tttView.style.display='none';

    memView.style.display='block';
    memHud.style.display = 'none';
    memGrid.innerHTML = '';
    memResult.style.display = 'none';
    window.scrollTo({top:0, behavior:'smooth'});
  }

  memEasyBtn.addEventListener('click', ()=> startMemory(4));
  memHardBtn.addEventListener('click', ()=> startMemory(6));

  function startMemory(types=4){
    TYPES_COUNT = types;
    buildMemDeck();
    renderMem();
    pairs = 0; moves = 0; lock = false; first = second = null;
    memOver = false; lives = MAX_LIVES;
    updateMemHud(); renderLives();
    memResult.style.display = 'none';
    memHud.style.display = 'flex';
    window.scrollTo({top:0, behavior:'smooth'});
  }
  function updateMemHud(){
    memMoves.textContent = `æ‰‹æ•°: ${moves}`;
    memPairs.textContent = `ãƒšã‚¢: ${pairs} / ${TYPES_COUNT}`;
  }
  function renderLives(){
    const hearts = memLives.querySelectorAll('.heart');
    hearts.forEach((h,i)=> h.classList.toggle('lost', i >= lives));
  }
  function buildMemDeck(){
    memDeck = [];
    for(let i=0;i<TYPES_COUNT;i++){ memDeck.push({id:i}); memDeck.push({id:i}); }
    for(let i=memDeck.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [memDeck[i], memDeck[j]] = [memDeck[j], memDeck[i]];
    }
  }
  function renderMem(){
    memGrid.innerHTML = '';
    memDeck.forEach((card, idx)=>{
      const c = document.createElement('div'); c.className = 'memCard'; c.dataset.index = idx;
      const inner = document.createElement('div'); inner.className = 'memInner'; inner.setAttribute('role','button'); inner.setAttribute('aria-label','ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹');
      const front = document.createElement('div'); front.className = 'memFace front';
      const img = document.createElement('img'); img.src = ICE_SET[card.id]?.img || ''; img.alt = ICE_SET[card.id]?.name || '';
      const emoji = document.createElement('span'); emoji.textContent = ICE_SET[card.id]?.emoji || 'â„ï¸'; emoji.style.fontSize = 'clamp(32px, 10vw, 56px)';
      img.addEventListener('load', ()=> { emoji.style.display='none'; });
      img.addEventListener('error',()=> { img.style.display='none'; });
      front.appendChild(img); front.appendChild(emoji);
      const back = document.createElement('div'); back.className = 'memFace back'; back.textContent = 'ğŸ¨';
      inner.appendChild(front); inner.appendChild(back); c.appendChild(inner); memGrid.appendChild(c);
      c.addEventListener('click', ()=> flipMem(idx, inner));
    });
  }
  function flipMem(idx, innerEl){
    if (memOver || lock) return;
    if (innerEl.classList.contains('flipped')) return;
    innerEl.classList.add('flipped');
    if (!first){ first = { idx, id: memDeck[idx].id, el: innerEl }; navigator.vibrate?.(15); return; }
    second = { idx, id: memDeck[idx].id, el: innerEl }; lock = true; moves++; updateMemHud();
    if (first.id === second.id){
      setTimeout(()=>{
        first.el.classList.add('matched'); second.el.classList.add('matched');
        pairs++; updateMemHud(); first = second = null; lock = false;
        if (pairs >= TYPES_COUNT){ memOver = true; memResult.style.display='block'; memResult.innerHTML = `<strong>ğŸ‰ ãœã‚“ã¶ãã‚ã£ãŸï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`; }
        navigator.vibrate?.([20,40,20]);
      }, 220);
    }else{
      lives = Math.max(0, lives - 1); renderLives();
      setTimeout(()=>{
        first.el.classList.remove('flipped'); second.el.classList.remove('flipped');
        first = second = null; lock = false; navigator.vibrate?.(30);
        if (lives <= 0 && !memOver){
          memOver = true; memResult.style.display='block';
          memResult.innerHTML = `<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;
        }
      }, 700);
    }
  }
  memRetry.addEventListener('click', ()=> startMemory(TYPES_COUNT));
  memBack.addEventListener('click', showTitle);

  /* =======================
     2048
     ======================= */
  function showScoop(){
    titleView.style.display='none'; gameView.style.display='none'; memView.style.display='none';
    duoSelect.style.display='none'; duoMenu.style.display='none'; tttView.style.display='none';
    scoopView.style.display='block'; setupScoop(); document.getElementById('scPad').style.display='block';
    window.scrollTo({top:0,behavior:'smooth'});
  }
  document.getElementById('scBack').addEventListener('click', ()=>{ document.getElementById('scPad').style.display='none'; showTitle(); });

  const scGridBg = document.getElementById('scGridBg');
  const scTiles  = document.getElementById('scTiles');
  const scScore  = document.getElementById('scScore');
  const scBest   = document.getElementById('scBest');
  const scUndo   = document.getElementById('scUndo');
  const scRetry  = document.getElementById('scRetry');
  const scResult = document.getElementById('scResult');

  const IMAGE_LABEL = {128:'å±‹å°',256:'ã‚¢ã‚¤ã‚¹',512:'åº—é•·',1024:'åº—é•·ã‚­ãƒ¡ãƒãƒ¼ã‚º',2048:'ç¤¾é•·'};
  let board = [], scoreNow = 0, best = Number(localStorage.getItem('scoop_best')||0), prevState=null;

  function setupScoop(){
    if (!scGridBg.childElementCount){ for(let i=0;i<16;i++){ const c=document.createElement('div'); c.className='cell'; scGridBg.appendChild(c); } }
    best = Number(localStorage.getItem('scoop_best')||0);
    scoreNow=0; board=new Array(16).fill(0); prevState=null; spawn(); spawn(); drawScoop(); scResult.style.display='none';
  }
  function spawn(){ const zeros=board.map((v,i)=>v===0?i:null).filter(v=>v!==null); if(!zeros.length) return false; const pos=zeros[Math.floor(Math.random()*zeros.length)]; board[pos]=Math.random()<0.9?2:4; return true; }
  function canMove(){ if (board.includes(0)) return true; for(let r=0;r<4;r++) for(let c=0;c<4;c++){ const i=r*4+c, v=board[i]; if(c<3&&board[i+1]===v) return true; if(r<3&&board[i+4]===v) return true; } return false; }
  function lineMove(line){ let arr=line.filter(v=>v!==0), gain=0; for(let i=0;i<arr.length-1;i++){ if(arr[i]&&arr[i]===arr[i+1]){ arr[i]*=2; gain+=arr[i]; arr[i+1]=0; i++; } } arr=arr.filter(v=>v!==0); while(arr.length<4) arr.push(0); return {line:arr,gain}; }
  function move(dir){
    const before=board.slice(); prevState={board:before.slice(),score:scoreNow}; let total=0;
    if(dir==='L'||dir==='R'){ for(let r=0;r<4;r++){ let row=board.slice(r*4, r*4+4); if(dir==='R') row.reverse(); const {line,gain}=lineMove(row); total+=gain; if(dir==='R') line.reverse(); for(let c=0;c<4;c++) board[r*4+c]=line[c]; } }
    else { for(let c=0;c<4;c++){ let col=[board[c],board[c+4],board[c+8],board[c+12]]; if(dir==='D') col.reverse(); const {line,gain}=lineMove(col); total+=gain; if(dir==='D') line.reverse(); [board[c],board[c+4],board[c+8],board[c+12]]=line; } }
    if(board.join('')===before.join('')){ prevState=null; return; }
    scoreNow+=total; if(scoreNow>best){ best=scoreNow; localStorage.setItem('scoop_best', String(best)); }
    spawn(); drawScoop(); checkScoop();
  }
  function checkScoop(){
    const mx=Math.max(...board);
    if(mx>=2048){ scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ‰ 2048é”æˆï¼${IMAGE_LABEL[2048]||''}</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`; }
    else scResult.style.display='none';
    if(!canMove()){ scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã‚¹ã‚³ã‚¢ ${scoreNow}ï¼ˆãƒ™ã‚¹ãƒˆ ${best}ï¼‰ ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`; }
  }
  function drawScoop(){
    scTiles.innerHTML='';
    for(let i=0;i<16;i++){
      const slot=document.createElement('div'); slot.className='slot';
      const v=board[i];
      if(v){
        const t=document.createElement('div'); t.className=`tile t${v}`;
        if(v>=128){
          const img=document.createElement('img'); img.className='tileImg'; img.src=`puzzle${v}.png`; img.alt=IMAGE_LABEL[v]||String(v);
          img.addEventListener('error',()=>{img.remove(); t.innerHTML=`<b>${v}</b>`;}); t.appendChild(img);
        }else{ t.innerHTML=`<b>${v}</b>`; }
        slot.appendChild(t);
      }
      scTiles.appendChild(slot);
    }
    scScore.textContent=`ã‚¹ã‚³ã‚¢: ${scoreNow}`; scBest.textContent=`ãƒ™ã‚¹ãƒˆ: ${best}`;
  }
  window.addEventListener('keydown', (e)=>{ if(scoopView.style.display!=='block') return; const k=e.key; if(k==='ArrowLeft')move('L'); else if(k==='ArrowRight')move('R'); else if(k==='ArrowUp')move('U'); else if(k==='ArrowDown')move('D'); });
  let sx=0, sy=0; scTiles.addEventListener('touchstart',(e)=>{const t=e.touches[0]; sx=t.clientX; sy=t.clientY;},{passive:true});
  scTiles.addEventListener('touchend',(e)=>{const t=e.changedTouches[0]; const dx=t.clientX-sx, dy=t.clientY-sy; const ax=Math.abs(dx), ay=Math.abs(dy), TH=24; if(ax<TH&&ay<TH)return; if(ax>ay)move(dx>0?'R':'L'); else move(dy>0?'D':'U');},{passive:true});
  document.getElementById('scUndo').addEventListener('click',()=>{ if(!prevState) return; board=prevState.board.slice(); scoreNow=prevState.score; prevState=null; drawScoop(); scResult.style.display='none'; });
  document.getElementById('scRetry').addEventListener('click', setupScoop);

  /* =======================
     2äººã§éŠã¶ï¼šã‚­ãƒ£ãƒ©é¸æŠ
     ======================= */
  const CHAR = [
    {id:1, key:'boss',  name:'åº—é•·',  img:'character1.png', alt:'character1-2.png'}, // â†åº—é•·ã ã‘é‡è¤‡OKï¼ˆ2äººç›®ã¯altç”»åƒï¼‰
    {id:2, key:'wife',  name:'å¥¥ã•ã‚“', img:'character2.png'},
    {id:3, key:'clerk', name:'ãƒã‚¤ãƒˆ', img:'character3.png'},
    {id:4, key:'ceo',   name:'ç¤¾é•·',   img:'character4.png'},
  ];
  const LINES = {
    boss : {win:'ä¿ºã«å‹ã¨ã†ãªã‚“ã¦100å¹´æ—©ã„ï¼', lose:'ã„ã‚„ãƒ¼ã‚“ï¼'},
    wife : {win:'è² ã‘ãªã„ã‚ã‚ˆï¼',              lose:'ä»Šæ—¥ã¯ã‚†ã‚‹ã—ã¦â€¦'},
    clerk: {win:'ã‚„ã£ãŸã£ã™ï¼',                lose:'ãƒã‚¸ã‹â€¦'},
    ceo  : {win:'ç§ãŒ1ç•ªã‚ˆï¼',                 lose:'ã‚ã‚“ãŸæ¸›çµ¦ã­â€¦'},
  };
  const BOSS_SPECIAL = {intro:'ä¿ºãŒ2äººï¼ï¼Ÿ', win:'ä¿ºãŒæœ¬ç‰©ã®åº—é•·ã ï¼', lose:'ä¿ºã«è² ã‘ãŸâ€¦'};

  let selStep=1;           // 1= P1é¸æŠä¸­, 2= P2é¸æŠä¸­
  let P1=null, P2=null;    // {id,key,name,img}

  const charGrid = document.getElementById('charGrid');
  const selectWho= document.getElementById('selectWho');
  const toDuoMenu= document.getElementById('toDuoMenu');
  const selBack  = document.getElementById('selBack');

  function showDuoSelect(){
    titleView.style.display='none'; gameView.style.display='none'; memView.style.display='none';
    scoopView.style.display='none'; duoMenu.style.display='none'; tttView.style.display='none';
    duoSelect.style.display='block';
    selStep=1; P1=null; P2=null; toDuoMenu.disabled=true;
    renderCharGrid();
    selectWho.innerHTML='ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­ï¼ˆåŒã˜ã‚­ãƒ£ãƒ©ã¯<em>åº—é•·ã ã‘OK</em>ï¼‰';
    window.scrollTo({top:0,behavior:'smooth'});
  }
  selBack.addEventListener('click', showTitle);

  function renderCharGrid(){
    charGrid.innerHTML='';
    CHAR.forEach(ch=>{
      const card=document.createElement('div'); card.className='charCard'; card.dataset.id=ch.id;
      const img=document.createElement('img'); img.src=ch.img; img.alt=ch.name;
      const label=document.createElement('div'); label.className='charLabel'; label.textContent=ch.name;
      card.appendChild(img); card.appendChild(label); charGrid.appendChild(card);

      card.addEventListener('click',()=>{
        // åº—é•·ä»¥å¤–ã¯é‡è¤‡ç¦æ­¢
        if(selStep===2 && P1 && P1.key!== 'boss' && ch.id===P1.id){
          selectWho.innerHTML='åŒã˜ã‚­ãƒ£ãƒ©ã¯ <strong>åº—é•·ã ã‘</strong> é¸ã¹ã‚‹ã‚ˆï¼';
          selectWho.style.color='#b00020';
          setTimeout(()=>{selectWho.style.color=''; selectWho.innerHTML='ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­';},1200);
          return;
        }
        // é¸æŠåæ˜ 
        if(selStep===1){
          P1={...ch};
          // UIãƒãƒ¼ã‚¯
          [...charGrid.children].forEach(c=>{c.classList.remove('selectedP1'); c.removeAttribute('data-select-label');});
          card.classList.add('selectedP1'); card.setAttribute('data-select-label','P1');
          selStep=2; selectWho.textContent='ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­';
        }else{
          // åº—é•·Ã—åº—é•·ãªã‚‰2äººç›®ã ã‘ alt ç”»åƒã¸
          P2={...ch};
          if(P1.key==='boss' && P2.key==='boss' && CHAR[0].alt){ P2.img = CHAR[0].alt; }
          [...charGrid.children].forEach(c=>{c.classList.remove('selectedP2');});
          card.classList.add('selectedP2'); card.setAttribute('data-select-label','P2');
          toDuoMenu.disabled=false;
        }
      });
    });
  }

  document.getElementById('toDuoMenu').addEventListener('click', ()=>{
    duoSelect.style.display='none'; duoMenu.style.display='block';
  });
  document.getElementById('duoBackToSelect').addEventListener('click', showDuoSelect);
  document.getElementById('duoBackToTitle').addEventListener('click', showTitle);

  /* =======================
     â—¯âœ–ï¼ˆãƒãƒ«ãƒãƒ„ï¼‰
     ======================= */
  const tttBoardEl = document.getElementById('tttBoard');
  const tttBubble  = document.getElementById('tttBubble');
  const p1Card = document.getElementById('p1Card'), p2Card = document.getElementById('p2Card');
  const p1Icon = document.getElementById('p1Icon'), p2Icon = document.getElementById('p2Icon');
  const p1Name = document.getElementById('p1Name'), p2Name = document.getElementById('p2Name');
  const p1Line = document.getElementById('p1Line'), p2Line = document.getElementById('p2Line');
  const turnLabel = document.getElementById('turnLabel');
  const tttRetry = document.getElementById('tttRetry');
  const tttToMenu= document.getElementById('tttToMenu');
  const tttBack  = document.getElementById('tttBack');

  document.getElementById('playTTT').addEventListener('click', startTTT);
  tttRetry.addEventListener('click', startTTT);
  tttToMenu.addEventListener('click', ()=>{ tttView.style.display='none'; duoMenu.style.display='block'; });
  tttBack.addEventListener('click', showTitle);

  let board3=[], turn='O', finished=false; // O= P1, X= P2

  function startTTT(){
    duoMenu.style.display='none'; tttView.style.display='block'; window.scrollTo({top:0,behavior:'smooth'});

    // HUD åˆæœŸåŒ–ï¼ˆã‚¢ã‚¤ã‚³ãƒ³å¤§ãã‚ï¼†ã‚¿ãƒ¼ãƒ³ä¸­ã¯èµ¤æ ï¼‰
    p1Icon.src = P1?.img || ''; p2Icon.src = P2?.img || '';
    p1Name.textContent = P1?.name || 'P1'; p2Name.textContent = P2?.name || 'P2';
    p1Line.textContent=''; p2Line.textContent='';
    turn='O'; finished=false; setTurnHud();

    // ç›¤é¢ç”Ÿæˆ
    board3 = Array(9).fill('');
    tttBoardEl.innerHTML='';
    for(let i=0;i<9;i++){
      const c=document.createElement('div'); c.className='cell'; c.dataset.i=i; c.textContent='';
      c.addEventListener('click', ()=> clickCell(i, c));
      tttBoardEl.appendChild(c);
    }

    // åº—é•·Ã—åº—é•·ãªã‚‰é–‹å§‹æ™‚ã«ã‚»ãƒªãƒ•
    if(P1?.key==='boss' && P2?.key==='boss'){
      tttBubble.innerHTML = BOSS_SPECIAL.intro;
      tttBubble.style.display='block';
      setTimeout(()=> tttBubble.style.display='none', 1200);
    }
    tttRetry.style.display='none'; tttToMenu.style.display='none';
  }

  function setTurnHud(){
    p1Card.classList.toggle('active', turn==='O');
    p2Card.classList.toggle('active', turn==='X');
    turnLabel.textContent = turn==='O' ? 'P1ã®ã‚¿ãƒ¼ãƒ³' : 'P2ã®ã‚¿ãƒ¼ãƒ³';
  }

  function clickCell(i, el){
    if(finished || board3[i]) return;
    board3[i] = turn;
    el.textContent = turn==='O' ? 'â—‹' : 'âœ•';
    el.classList.add('disabled');

    const res = judgeTTT();
    if(res){ endTTT(res); return; }
    // å…¥ã‚Œæ›¿ãˆ
    turn = (turn==='O') ? 'X' : 'O';
    setTurnHud();
  }

  function judgeTTT(){
    const L=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const [a,b,c] of L){
      if(board3[a] && board3[a]===board3[b] && board3[b]===board3[c]) return board3[a]; // 'O' or 'X'
    }
    if(board3.every(v=>v)) return 'D'; // draw
    return '';
  }

  function endTTT(result){
    finished=true;
    // ç›¤é¢ã‚¯ãƒªãƒƒã‚¯ç„¡åŠ¹åŒ–
    [...tttBoardEl.children].forEach(c=>c.classList.add('disabled'));

    let winnerText='';
    if(result==='O'){ winnerText='ğŸ‰ P1ã®å‹ã¡ï¼'; setLines('P1'); }
    else if(result==='X'){ winnerText='ğŸ‰ P2ã®å‹ã¡ï¼'; setLines('P2'); }
    else { winnerText='å¼•ãåˆ†ã‘ï¼'; p1Line.textContent='ã‚„ã‚‹ã­ï¼'; p2Line.textContent='æ¬¡ã¯ã„ã‘ã‚‹ï¼'; }

    tttBubble.innerHTML = `<strong>${winnerText}</strong>`;
    tttBubble.style.display='block';
    tttRetry.style.display='inline-block';
    tttToMenu.style.display='inline-block';
  }

  // å‹æ•—ã‚»ãƒªãƒ•ã‚’å„ã‚¢ã‚¤ã‚³ãƒ³ä¸‹ã«è¡¨ç¤ºï¼ˆåº—é•·Ã—åº—é•·ã¯ç‰¹åˆ¥ã‚»ãƒªãƒ•ï¼‰
  function setLines(whoWin){
    const P1key=P1.key, P2key=P2.key;
    if(P1key==='boss' && P2key==='boss'){
      if(whoWin==='P1'){ p1Line.textContent=BOSS_SPECIAL.win;  p2Line.textContent=BOSS_SPECIAL.lose; }
      else             { p1Line.textContent=BOSS_SPECIAL.lose; p2Line.textContent=BOSS_SPECIAL.win;  }
      return;
    }
    if(whoWin==='P1'){
      p1Line.textContent = (LINES[P1key]?.win)||'ã‚„ã£ãŸï¼';
      p2Line.textContent = (LINES[P2key]?.lose)||'ãã‚„ã—ã„â€¦';
    }else{
      p1Line.textContent = (LINES[P1key]?.lose)||'ãã‚„ã—ã„â€¦';
      p2Line.textContent = (LINES[P2key]?.win)||'ã‚„ã£ãŸï¼';
    }
  }
</script>
</body>
</html>
