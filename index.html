<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ãƒŸãƒ‹ã‚²ãƒ¼ãƒ </title>

<style>
  :root{
    --bg:#97d2e4; --ink:#0c2a33; --muted:#215b6b;
    --white:#fff; --pill:#e6f7fd; --btn:#10aee3; --btn-ink:#fff;
    --card:#ffffffef; --win:#0da66e; --lose:#d94848; --ring:#ff4d4d;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
  .wrap{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
  .container{width:min(900px,92vw);margin:0 auto;padding:16px 0 28px}

  h1{margin:8px 0 4px;font-size:clamp(22px,5.8vw,36px);letter-spacing:.06em;text-align:center}
  .sub{margin:0 0 12px;color:var(--muted);text-align:center;font-size:clamp(12px,3.6vw,15px)}
  .btnrow{display:flex;gap:14px;justify-content:center;align-items:center;margin:10px 0 0;flex-wrap:wrap}
  .btn{appearance:none;border:none;border-radius:14px;cursor:pointer;font-weight:800;letter-spacing:.06em}
  .btn.primary{background:var(--btn);color:var(--btn-ink);padding:14px 22px;font-size:clamp(14px,4.8vw,18px)}
  .btn.ghost{background:transparent;color:#083b48;border:2px solid #083b4840;padding:12px 20px;border-radius:16px;font-size:clamp(14px,4.8vw,18px)}
  .pill{display:inline-block;padding:.45em 1em;border-radius:999px;background:var(--pill);font-weight:700;color:#222;font-size:clamp(12px,3.8vw,16px)}
  .resultCard{display:none;margin:14px auto 0;max-width:720px;background:var(--card);border-radius:16px;padding:14px 16px;text-align:center;font-size:clamp(14px,4.4vw,18px);box-shadow:0 12px 28px #07495926}
  .win{color:var(--win);font-weight:800}.lose{color:var(--lose);font-weight:800}

  /* ===== ã‚¿ã‚¤ãƒˆãƒ« ===== */
  #title{display:grid;place-items:center;background:url("bg-title.png") center/cover no-repeat;border-radius:20px}
  #title .hero{width:100%;backdrop-filter:saturate(130%) blur(0px)}
  #title h2{margin:6px 0 0;text-align:center;line-height:1.25;font-size:clamp(22px,6.2vw,34px)}
  .title-illus{width:min(620px,92vw);max-height:62svh;object-fit:contain;object-position:center bottom;display:block;margin:8px auto 2px;pointer-events:none}
  .speech{display:none;margin:8px auto 0;padding:.6em 1em;border-radius:12px;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,.12);font-weight:800;text-align:center}

  /* ===== 2048 ===== */
  #scoop{display:none}
  .scoopHud{display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
  .scoopHud span{background:#ffffffcc;padding:8px 12px;border-radius:10px;box-shadow:0 6px 16px #00000012}
  .scoopBtns{display:flex;gap:10px}
  .scoopBoard{width:min(520px,92vw);margin:12px auto 0;position:relative}
  .scGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:#bde3ef;padding:10px;border-radius:14px}
  .scGrid .cell{aspect-ratio:1/1;border-radius:10px;background:#e6f7fd}
  .scTiles{position:absolute;inset:0;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px}
  .scTiles>.slot{aspect-ratio:1/1}
  .tile{width:100%;height:100%;border-radius:12px;display:grid;place-items:center;font-weight:900;text-align:center;line-height:1.1;box-shadow:0 10px 24px rgba(0,0,0,.12);user-select:none;animation:tileIn .18s ease;color:#083b48;font-size:clamp(12px,3.6vw,15px)}
  .tile b{display:block;font-size:clamp(18px,6vw,26px)}
  @keyframes tileIn{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}
  .tile.merge{animation:mergePop .22s ease}@keyframes mergePop{0%{transform:scale(1)}50%{transform:scale(1.08)}100%{transform:scale(1)}}
  .tile.spawn{box-shadow:0 0 0 4px #fff inset,0 10px 24px rgba(0,0,0,.12)}
  .t2{background:#fffdf5}.t4{background:#fff6da}.t8{background:#ffe1e9}.t16{background:#f6d7c7}.t32{background:#d8f0dc}.t64{background:#d7f0fb}.t128{background:#ffe9c2}.t256{background:#f7d9ff}.t512{background:#d9fff1}.t1024{background:#fff0c5}.t2048{background:#ffe7e7}
  .tileImg{width:86%;height:86%;object-fit:contain;pointer-events:none}
  #scPad{position:sticky;bottom:env(safe-area-inset-bottom,12px);margin-top:16px;z-index:5;display:none}
  .pad{width:180px;height:160px;margin:0 auto;position:relative;display:grid;place-items:center}
  .pad button{position:absolute;width:56px;height:56px;border-radius:50%;border:none;background:#ffffffd8;box-shadow:0 8px 18px #00000018;font-size:22px;font-weight:900;color:#0c2a33;cursor:pointer}
  .pad .up{top:0;left:50%;transform:translate(-50%,0)} .pad .down{bottom:0;left:50%;transform:translate(-50%,0)} .pad .left{left:0;top:50%;transform:translate(0,-50%)} .pad .right{right:0;top:50%;transform:translate(0,-50%)}

  /* ===== 2äººç”¨ å…±é€šï¼ˆãƒ˜ãƒƒãƒ€ï¼‰ ===== */
  .duoHud{display:flex;justify-content:space-between;gap:10px;align-items:center;margin:10px auto 12px;max-width:740px}
  .pBox{display:flex;align-items:center;gap:8px;background:#ffffffee;border-radius:999px;padding:6px 10px;box-shadow:0 6px 14px #00000018;min-width:160px}
  .pIcon{width:34px;height:34px;border-radius:50%;object-fit:cover;border:3px solid transparent}
  .pIcon.turn{border-color:var(--ring)}
  .pName{font-weight:900}
  .pLine{font-size:12px;color:#335}
  .stagePanel{background:#ffffff3a;border-radius:18px;padding:12px}

  /* ===== 2äººç”¨ï¼šã‚­ãƒ£ãƒ©é¸æŠ ===== */
  #duo{display:none}
  .charGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;max-width:760px;margin:10px auto 14px}
  .charCard{background:#fff;border-radius:16px;box-shadow:0 10px 22px #00000018;padding:10px;display:flex;flex-direction:column;align-items:center;gap:6px;cursor:pointer;border:3px solid transparent}
  .charCard.selected{border-color:#16b1e6}
  .charCard img{width:100%;aspect-ratio:3/4;object-fit:cover;border-radius:12px}
  .smallNote{text-align:center;color:#083b48aa}

  /* ===== â—‹Ã—ã‚²ãƒ¼ãƒ  ===== */
  #ttt{display:none}
  .tttWrap{max-width:760px;margin:12px auto;background:url("stage33.png") center/cover no-repeat;border-radius:20px;padding:18px}
  .tttGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .tttCell{aspect-ratio:1/1;border-radius:14px;background:#e6f7fd;display:grid;place-items:center;box-shadow:inset 0 0 0 2px #cde7f2, 0 8px 18px #00000018;font-size:clamp(44px,14vw,72px);cursor:pointer}
  .tttCell.disabled{pointer-events:none;opacity:.7}

  /* ===== å››ç›®ä¸¦ã¹ ===== */
  #c4{display:none}
  .c4Wrap{max-width:820px;margin:12px auto;background:url("stage76.png") center/cover no-repeat;border-radius:20px;padding:16px}
  .c4Board{position:relative;display:grid;grid-template-columns:repeat(7,1fr);gap:10px;background:#bde3ef;padding:10px;border-radius:14px}
  .c4Hole{aspect-ratio:1/1;background:#e6f7fd;border-radius:50%;box-shadow:inset 0 0 0 2px #cde7f2}
  .c4Piece{width:100%;height:100%;border-radius:50%;overflow:hidden;display:grid;place-items:center}
  .c4Piece img{width:88%;height:88%;object-fit:contain}
  .fall{position:absolute;left:0;top:-60px;transform:translate(var(--x,0),0);width:calc((100% - 60px)/7);aspect-ratio:1/1;border-radius:50%;display:grid;place-items:center;overflow:hidden;animation:drop .28s ease-out forwards}
  .fall img{width:88%;height:88%;object-fit:contain}
  @keyframes drop{to{top:var(--toY)}}
</style>
</head>
<body>
<div class="wrap">

  <!-- ===== ã‚¿ã‚¤ãƒˆãƒ« ===== -->
  <div class="container" id="title">
    <div class="hero">
      <span class="pill" id="titlePill">ã‚ã¡ã‚ƒã¤ã‚ˆã£ï¼</span>
      <h2>ãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ã®<br>ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒ¼ã‚¯</h2>

      <img id="titleImg" class="title-illus" src="title-start2.png" alt="åº—é•·ãƒãƒ¼ã‚º">
      <div id="speech" class="speech">ä¿ºã®å¼·ã•ã«æ€–æ°—ã¥ã„ãŸã‹ã£ï¼</div>

      <div class="btnrow">
        <button class="btn primary" id="btnScoop">2048ã§éŠã¶</button>
        <button class="btn ghost" id="btnDuo">2äººã§éŠã¶</button>
      </div>
      <p class="sub">åº—é•· vs ã¿ã‚“ãªã§ã€ã‚†ã‚‹ã£ã¨å¯¾æˆ¦ï¼</p>
    </div>
  </div>

  <!-- ===== 2048ï¼ˆåˆæˆãƒ‘ã‚ºãƒ«ï¼‰===== -->
  <div class="container" id="scoop">
    <h1>ã€œ2048ãƒ‘ã‚ºãƒ«ã€œ</h1>
    <p class="sub">åŒã˜æ•°å­—ã‚’åˆä½“ã•ã›ã¦é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†</p>

    <div class="scoopHud">
      <span id="scScore">ã‚¹ã‚³ã‚¢: 0</span>
      <span id="scBest">ãƒ™ã‚¹ãƒˆ: 0</span>
      <div class="scoopBtns">
        <button class="btn ghost" id="scUndo">1æ‰‹æˆ»ã‚‹</button>
        <button class="btn ghost" id="scRetry">ã‚‚ã†ä¸€å›</button>
      </div>
    </div>

    <div class="scoopBoard">
      <div class="scGrid" id="scGridBg"></div>
      <div class="scTiles" id="scTiles"></div>
    </div>

    <div class="resultCard" id="scResult" style="display:none; margin-top:14px"></div>

    <div id="scPad">
      <div class="pad">
        <button class="up"    aria-label="ä¸Šã¸">â†‘</button>
        <button class="left"  aria-label="å·¦ã¸">â†</button>
        <button class="right" aria-label="å³ã¸">â†’</button>
        <button class="down"  aria-label="ä¸‹ã¸">â†“</button>
      </div>
    </div>

    <div class="btnrow" style="margin-top:12px">
      <button class="btn ghost" id="toTitleFromScoop">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
      <button class="btn ghost" id="toDuoFromScoop">2äººã§éŠã¶</button>
    </div>
  </div>

  <!-- ===== 2äººãƒ¢ãƒ¼ãƒ‰ï¼šã‚­ãƒ£ãƒ©é¸æŠ ===== -->
  <div class="container" id="duo">
    <h1>2äººã§éŠã¶</h1>
    <p class="sub">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã¨2ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­ï¼ˆåŒã˜ã¯åº—é•·ã®ã¿OKï¼‰</p>

    <div class="charGrid" id="charGrid">
      <!-- 4æšä¸¦ã³ï¼ˆåº—é•·å¤ / å¥¥ã•ã‚“ / ãƒã‚¤ãƒˆ / ç¤¾é•·ï¼‰ -->
    </div>
    <p class="smallNote" id="pickNote">P1 â†’ P2 ã®é †ã§é¸æŠã—ã¾ã™ã€‚</p>

    <div class="btnrow">
      <button class="btn ghost" id="duoBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ===== â—‹Ã—ã‚²ãƒ¼ãƒ  ===== -->
  <div class="container" id="ttt">
    <h1>ã€œâ—‹Ã—ã‚²ãƒ¼ãƒ ã€œ</h1>
    <div class="duoHud">
      <div class="pBox">
        <img id="p1Icon_ttt" class="pIcon" src="" alt=""><div>
          <div class="pName" id="p1Name_ttt">P1</div>
          <div class="pLine" id="p1Line_ttt"></div>
        </div>
      </div>
      <div class="pill" id="turnText_ttt">P1ã®ã‚¿ãƒ¼ãƒ³</div>
      <div class="pBox">
        <img id="p2Icon_ttt" class="pIcon" src="" alt=""><div>
          <div class="pName" id="p2Name_ttt">P2</div>
          <div class="pLine" id="p2Line_ttt"></div>
        </div>
      </div>
    </div>

    <div class="tttWrap stagePanel">
      <div class="tttGrid" id="tttGrid"></div>
    </div>

    <div class="resultCard" id="tttResult"></div>

    <div class="btnrow">
      <button class="btn ghost" id="tttRetry">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="goSelectFromTtt">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
      <button class="btn ghost" id="tttBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ===== å››ç›®ä¸¦ã¹ï¼ˆ7Ã—6ï¼‰ ===== -->
  <div class="container" id="c4">
    <h1>ã€œã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰ã€œ</h1>

    <div class="duoHud">
      <div class="pBox">
        <img id="p1Icon_c4" class="pIcon" src="" alt=""><div>
          <div class="pName" id="p1Name_c4">P1</div>
          <div class="pLine" id="p1Line_c4"></div>
        </div>
      </div>
      <div class="pill" id="turnText_c4">P1ã®ã‚¿ãƒ¼ãƒ³</div>
      <div class="pBox">
        <img id="p2Icon_c4" class="pIcon" src="" alt=""><div>
          <div class="pName" id="p2Name_c4">P2</div>
          <div class="pLine" id="p2Line_c4"></div>
        </div>
      </div>
    </div>

    <div class="c4Wrap stagePanel">
      <div class="c4Board" id="c4Board"></div>
    </div>

    <div class="resultCard" id="c4Result"></div>

    <div class="btnrow">
      <button class="btn ghost" id="c4Retry">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="goSelectFromC4">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
      <button class="btn ghost" id="c4Back">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ===== 2äººãƒ¢ãƒ¼ãƒ‰ï¼šã‚²ãƒ¼ãƒ é¸æŠ ===== -->
  <div class="container" id="duoSelect" style="display:none">
    <h1>å¯¾æˆ¦ã‚²ãƒ¼ãƒ ã‚’é¸ã¶</h1>
    <div class="btnrow">
      <button class="btn primary" id="selTTT">â—‹Ã—ã‚²ãƒ¼ãƒ </button>
      <button class="btn primary" id="selC4">ã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰</button>
    </div>
    <div class="btnrow">
      <button class="btn ghost" id="backToChars">ã‚­ãƒ£ãƒ©ã‚’é¸ã³ç›´ã™</button>
      <button class="btn ghost" id="selectBackTitle">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

</div><!-- /.wrap -->

<script>
/* =========================================================
   å…±é€šï¼šç”»é¢åˆ‡ã‚Šæ›¿ãˆ
========================================================= */
const views = {
  title: document.getElementById('title'),
  scoop: document.getElementById('scoop'),
  duo  : document.getElementById('duo'),
  duoSelect: document.getElementById('duoSelect'),
  ttt  : document.getElementById('ttt'),
  c4   : document.getElementById('c4'),
};
function show(id){
  for(const k in views) views[k].style.display = (k===id)?'block':'none';
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒœã‚¿ãƒ³ */
document.getElementById('btnScoop').addEventListener('click', ()=>{ show('scoop'); setupScoop(); document.getElementById('scPad').style.display='block'; });
document.getElementById('btnDuo').addEventListener('click', ()=>{ show('duo'); startCharSelect(); });

/* æˆ»ã‚‹ç³» */
document.getElementById('toTitleFromScoop').addEventListener('click', ()=>{ document.getElementById('scPad').style.display='none'; show('title'); });
document.getElementById('toDuoFromScoop').addEventListener('click', ()=>{ show('duo'); startCharSelect(); });
document.getElementById('duoBack').addEventListener('click', ()=> show('title'));
document.getElementById('tttBack').addEventListener('click', ()=> show('title'));
document.getElementById('c4Back').addEventListener('click', ()=> show('title'));
document.getElementById('selectBackTitle').addEventListener('click', ()=> show('title'));
document.getElementById('backToChars').addEventListener('click', ()=>{ show('duo'); startCharSelect(); });

/* =========================================================
   ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ã‚³ã‚¤ãƒ³è¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡å®šã©ãŠã‚Šï¼‰
========================================================= */
const CHARS = {
  tenchoSummer: { id:'tenchoSummer', name:'åº—é•·', icon:'character1.png', coin:'coin1.png',
    lines:{win:'ä¿ºã«å‹ã¨ã†ãªã‚“ã¦100å¹´æ—©ã„ï¼', lose:'ã„ã‚„ãƒ¼ã‚“ï¼'} },
  tenchoWinter: { id:'tenchoWinter', name:'åº—é•·(å†¬)', icon:'character1-2.png', coin:'coin1-2.png',
    lines:{win:'æœ¬æ°—ã®ä¿ºã¯å¯’ã•çŸ¥ã‚‰ãšï¼', lose:'ã•ã‚€â€¦è² ã‘ãŸâ€¦'} },
  okusan:       { id:'okusan', name:'å¥¥ã•ã‚“', icon:'character2.png', coin:'coin2.png',
    lines:{win:'ã¯ã„ã€ç§ã®å‹ã¡â™¡', lose:'æ¬¡ã¯è² ã‘ãªã„ã‚“ã ã‹ã‚‰ï¼'} },
  baito:        { id:'baito', name:'ãƒã‚¤ãƒˆ', icon:'character3.png', coin:'coin3.png',
    lines:{win:'ã‚„ã£ãŸã£ã™ï¼', lose:'ãƒã‚¸ã‹â€¦'} },
  shacho:       { id:'shacho', name:'ç¤¾é•·', icon:'character4.png', coin:'coin4.png',
    lines:{win:'ç§ãŒ1ç•ªã‚ˆï¼', lose:'ã‚ã‚“ãŸæ¸›çµ¦ã­â€¦'} },
};
const CHAR_ORDER = [CHARS.tenchoSummer, CHARS.okusan, CHARS.baito, CHARS.shacho];

/* é¸æŠçŠ¶æ…‹ */
let P1=null, P2=null;

/* ã‚­ãƒ£ãƒ©é¸æŠç”»é¢æ§‹ç¯‰ï¼ˆ4æšä¸¦ã³ / äº¤äº’ã‚¯ãƒªãƒƒã‚¯ / P2é¸ã‚“ã ã‚‰è‡ªå‹•ã§ã‚²ãƒ¼ãƒ é¸æŠã¸ï¼‰ */
const charGrid = document.getElementById('charGrid');
const pickNote = document.getElementById('pickNote');

function startCharSelect(){
  P1 = P2 = null;
  charGrid.innerHTML='';
  pickNote.textContent = 'P1 â†’ P2 ã®é †ã§é¸æŠã—ã¾ã™ã€‚';

  CHAR_ORDER.forEach(ch=>{
    const card = document.createElement('div');
    card.className='charCard';
    card.innerHTML = `<img src="${ch.icon}" alt="${ch.name}"><b>${ch.name}</b>`;
    card.addEventListener('click', ()=>{
      // åº—é•·åŒå£«ã¯OKã€ãã‚Œä»¥å¤–ã®åŒä¸€é¸æŠã¯ä¸å¯
      if(P1 && !P2){
        if(P1.id!==CHARS.tenchoSummer.id && ch.id===P1.id){
          alert('åŒã˜ã‚­ãƒ£ãƒ©ã‚’2äººã¯é¸ã¹ã¾ã›ã‚“ï¼ˆåº—é•·ã®ã¿OKï¼‰');
          return;
        }
      }
      // é¸æŠç¢ºå®š
      if(!P1){ P1 = ch; card.classList.add('selected'); pickNote.textContent='P2ã‚’é¸æŠã—ã¦ãã ã•ã„'; return; }
      if(!P2){
        // åº—é•·åŒå£«ãªã‚‰P2ã¯å†¬æœã«è‡ªå‹•åˆ‡æ›¿
        if(P1.id===CHARS.tenchoSummer.id && ch.id===CHARS.tenchoSummer.id){
          P2 = CHARS.tenchoWinter;
        }else{
          P2 = ch;
        }
        // ã€Œä¿ºãŒ2äºº!?ã€ãƒ•ãƒ©ã‚°
        duoSpecial_TenchoTwo = (P1.id===CHARS.tenchoSummer.id && P2.id===CHARS.tenchoWinter.id);
        // è‡ªå‹•ã§ã‚²ãƒ¼ãƒ é¸æŠã¸
        openDuoSelect();
      }
    });
    charGrid.appendChild(card);
  });
}

/* ã‚²ãƒ¼ãƒ é¸æŠã¸ */
function openDuoSelect(){
  show('duoSelect');
}

/* =========================================================
   2äººç”¨ï¼šå…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
========================================================= */
let currentTurn = 1; // 1 or 2
let duoSpecial_TenchoTwo = false;

function randomizeFirst(){
  currentTurn = Math.random()<0.5 ? 1 : 2;
}

/* ã‚¿ãƒ¼ãƒ³UIæ›´æ–°ï¼ˆè©²å½“ãƒ“ãƒ¥ãƒ¼ã«åˆã‚ã›ã¦ï¼‰ */
function paintTurn(forId){
  const a = document.getElementById('p1Icon_'+forId);
  const b = document.getElementById('p2Icon_'+forId);
  const t = document.getElementById('turnText_'+forId);
  a.classList.toggle('turn', currentTurn===1);
  b.classList.toggle('turn', currentTurn===2);
  t.textContent = (currentTurn===1?'P1':'P2') + 'ã®ã‚¿ãƒ¼ãƒ³';
}

/* å‹æ•—ã‚»ãƒªãƒ•ï¼ˆã‚­ãƒ£ãƒ©ã”ã¨ï¼‰ */
function setLines(forId, left, right){
  document.getElementById('p1Line_'+forId).textContent = left || '';
  document.getElementById('p2Line_'+forId).textContent = right || '';
}

/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼è¡¨ç¤ºã‚»ãƒƒãƒˆ */
function mountPlayers(forId){
  document.getElementById('p1Icon_'+forId).src = P1.icon;
  document.getElementById('p2Icon_'+forId).src = P2.icon;
  document.getElementById('p1Name_'+forId).textContent = P1.name;
  document.getElementById('p2Name_'+forId).textContent = P2.name;
}

/* =========================================================
   â—‹Ã—ã‚²ãƒ¼ãƒ ï¼ˆ3Ã—3ï¼‰
========================================================= */
const tttGrid = document.getElementById('tttGrid');
const tttResult = document.getElementById('tttResult');

let tttBoard = Array(9).fill(0); // 0ç©º / 1:P1 / 2:P2
const WINLINES = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

function startTTT(){
  show('ttt');
  tttBoard = Array(9).fill(0);
  tttGrid.innerHTML='';
  randomizeFirst();
  mountPlayers('ttt');
  paintTurn('ttt');
  setLines('ttt','','');
  tttResult.style.display='none';

  // åº—é•·Ã—2ã®ç‰¹åˆ¥ã‚»ãƒªãƒ•ï¼ˆã‚²ãƒ¼ãƒ é–‹å§‹æ™‚1å›ï¼‰
  if(duoSpecial_TenchoTwo){ setLines('ttt','ä¿ºãŒ2äººï¼ï¼Ÿ','ä¿ºãŒ2äººï¼ï¼Ÿ'); }

  for(let i=0;i<9;i++){
    const cell = document.createElement('div');
    cell.className='tttCell';
    cell.addEventListener('click', ()=>markTTT(i, cell));
    tttGrid.appendChild(cell);
  }
}

function markTTT(i, cell){
  if(tttBoard[i]!==0) return;
  tttBoard[i] = currentTurn;
  cell.textContent = currentTurn===1 ? 'â—‹' : 'Ã—';

  // å‹æ•—åˆ¤å®š
  const winner = judgeTTT();
  if(winner){
    finishTTT(winner);
    return;
  }
  if(tttBoard.every(v=>v!==0)){
    finishTTT(0);
    return;
  }
  currentTurn = (currentTurn===1?2:1);
  paintTurn('ttt');
}

function judgeTTT(){
  for(const [a,b,c] of WINLINES){
    if(tttBoard[a] && tttBoard[a]===tttBoard[b] && tttBoard[a]===tttBoard[c]) return tttBoard[a];
  }
  return 0;
}
function finishTTT(w){
  // ã‚»ãƒªãƒ•
  if(w===1){
    setLines('ttt', P1.lines.win || '', P2.lines.lose || '');
    tttResult.innerHTML = `<strong>ğŸ‰ P1ã®å‹ã¡ï¼</strong>`;
  }else if(w===2){
    setLines('ttt', P1.lines.lose || '', P2.lines.win || '');
    tttResult.innerHTML = `<strong>ğŸ‰ P2ã®å‹ã¡ï¼</strong>`;
  }else{
    setLines('ttt','å¼•ãåˆ†ã‘ã ã­','å¼•ãåˆ†ã‘ã ã­');
    tttResult.innerHTML = `<strong>ğŸ˜® å¼•ãåˆ†ã‘ï¼</strong>`;
  }
  tttResult.style.display='block';
  // åº—é•·åŒå£«ã ã‘ç‰¹åˆ¥è¿½ã„ã‚»ãƒªãƒ•
  if(duoSpecial_TenchoTwo && w!==0){
    if(w===1){ setLines('ttt','ä¿ºãŒæœ¬ç‰©ã®åº—é•·ã ï¼','ä¿ºã«è² ã‘ãŸâ€¦'); }
    if(w===2){ setLines('ttt','ä¿ºã«è² ã‘ãŸâ€¦','ä¿ºãŒæœ¬ç‰©ã®åº—é•·ã ï¼'); }
  }
  // ç›¤ã‚’ãƒ­ãƒƒã‚¯
  [...tttGrid.children].forEach(c=>c.classList.add('disabled'));
}
document.getElementById('tttRetry').addEventListener('click', startTTT);
document.getElementById('goSelectFromTtt').addEventListener('click', openDuoSelect);

/* =========================================================
   å››ç›®ä¸¦ã¹ï¼ˆ7Ã—6ï¼‰ ã‚³ã‚¤ãƒ³è½ã¨ã—ï¼‹è½ä¸‹æ¼”å‡º
========================================================= */
const c4BoardEl = document.getElementById('c4Board');
const c4Result = document.getElementById('c4Result');

let c4; // [row][col] 0ç©º/1/2

function startC4(){
  show('c4');
  randomizeFirst();
  mountPlayers('c4');
  paintTurn('c4');
  setLines('c4','','');
  c4Result.style.display='none';

  // åº—é•·Ã—2é–‹å§‹ã‚»ãƒªãƒ•
  if(duoSpecial_TenchoTwo){ setLines('c4','ä¿ºãŒ2äººï¼ï¼Ÿ','ä¿ºãŒ2äººï¼ï¼Ÿ'); }

  c4 = Array.from({length:6}, ()=>Array(7).fill(0));
  c4BoardEl.innerHTML='';
  for(let r=0;r<6;r++){
    for(let c=0;c<7;c++){
      const hole = document.createElement('div');
      hole.className='c4Hole';
      hole.addEventListener('click',()=> dropAt(c));
      c4BoardEl.appendChild(hole);
    }
  }
}

function dropAt(col){
  // ç©ºãè¡Œã‚’æ¢ã™ï¼ˆä¸‹ã‹ã‚‰ï¼‰
  let row = -1;
  for(let r=5;r>=0;r--){ if(c4[r][col]===0){ row=r; break; } }
  if(row===-1) return; // ã„ã£ã±ã„

  // è½ä¸‹æ¼”å‡º
  const rect = c4BoardEl.getBoundingClientRect();
  const slotW = (rect.width - 60) / 7; // gap=10px*6=60
  const fall = document.createElement('div');
  fall.className='fall';
  fall.style.setProperty('--x', `${col*(slotW+10)}px`);
  fall.style.setProperty('--toY', `${row*(slotW+10)+10}px`);
  const img = document.createElement('img');
  img.src = (currentTurn===1?P1.coin:P2.coin);
  fall.appendChild(img);
  c4BoardEl.appendChild(fall);

  fall.addEventListener('animationend', ()=>{
    fall.remove();
    // ç›¤ã«ç¢ºå®š
    c4[row][col] = currentTurn;
    const cell = c4BoardEl.children[row*7+col];
    const piece = document.createElement('div');
    piece.className='c4Piece';
    piece.innerHTML = `<img src="${currentTurn===1?P1.coin:P2.coin}" alt="">`;
    cell.innerHTML=''; cell.appendChild(piece);

    // åˆ¤å®š
    const w = judgeC4(row,col,currentTurn);
    if(w){
      finishC4(w);
      return;
    }
    if(c4.every(r=>r.every(v=>v!==0))){
      c4Result.innerHTML = `<strong>ğŸ˜® å¼•ãåˆ†ã‘ï¼</strong>`;
      c4Result.style.display='block';
      return;
    }
    currentTurn = (currentTurn===1?2:1);
    paintTurn('c4');
  }, {once:true});
}

function judgeC4(r,c,pl){
  const dirs = [[1,0],[0,1],[1,1],[1,-1]];
  for(const [dx,dy] of dirs){
    let cnt=1;
    for(let k=1;k<4;k++){ const x=c+k*dx, y=r+k*dy; if(y<0||y>5||x<0||x>6||c4[y][x]!==pl) break; cnt++; }
    for(let k=1;k<4;k++){ const x=c-k*dx, y=r-k*dy; if(y<0||y>5||x<0||x>6||c4[y][x]!==pl) break; cnt++; }
    if(cnt>=4) return pl;
  }
  return 0;
}

function finishC4(w){
  if(w===1){
    setLines('c4', P1.lines.win || '', P2.lines.lose || '');
    c4Result.innerHTML = `<strong>ğŸ‰ P1ã®å‹ã¡ï¼</strong>`;
  }else{
    setLines('c4', P1.lines.lose || '', P2.lines.win || '');
    c4Result.innerHTML = `<strong>ğŸ‰ P2ã®å‹ã¡ï¼</strong>`;
  }
  c4Result.style.display='block';
  // åº—é•·åŒå£«ã®ç‰¹åˆ¥ã‚»ãƒªãƒ•
  if(duoSpecial_TenchoTwo){
    if(w===1){ setLines('c4','ä¿ºãŒæœ¬ç‰©ã®åº—é•·ã ï¼','ä¿ºã«è² ã‘ãŸâ€¦'); }
    if(w===2){ setLines('c4','ä¿ºã«è² ã‘ãŸâ€¦','ä¿ºãŒæœ¬ç‰©ã®åº—é•·ã ï¼'); }
  }
  // ç›¤ãƒ­ãƒƒã‚¯ï¼šã‚¤ãƒ™ãƒ³ãƒˆã‚’å¤–ã™
  [...c4BoardEl.children].forEach(h=>h.replaceWith(h.cloneNode(true)));
}
document.getElementById('c4Retry').addEventListener('click', startC4);
document.getElementById('goSelectFromC4').addEventListener('click', openDuoSelect);

/* Duoé¸æŠ â†’ å„ã‚²ãƒ¼ãƒ ã¸ */
document.getElementById('selTTT').addEventListener('click', startTTT);
document.getElementById('selC4').addEventListener('click', startC4);

/* =========================================================
   2048ï¼ˆåˆæˆãƒ‘ã‚ºãƒ«ï¼‰â€»çŸ¢å°ãƒ‘ãƒƒãƒ‰å¾©æ´»ï¼†æ–°è¦ã‚¿ã‚¤ãƒ«å¼·èª¿
========================================================= */
const scGridBg = document.getElementById('scGridBg');
const scTiles  = document.getElementById('scTiles');
const scScore  = document.getElementById('scScore');
const scBest   = document.getElementById('scBest');
const scUndo   = document.getElementById('scUndo');
const scRetry  = document.getElementById('scRetry');
const scResult = document.getElementById('scResult');

const IMAGE_LABEL = {128:'å±‹å°',256:'ã‚¢ã‚¤ã‚¹',512:'åº—é•·',1024:'åº—é•·ã‚­ãƒ¡ãƒãƒ¼ã‚º',2048:'ç¤¾é•·'};

let board = [];       // 16é•·é…åˆ—ï¼ˆ0=ç©ºï¼‰
let scoreNow = 0;
let best = Number(localStorage.getItem('scoop_best') || 0);
let prevState = null; // undoç”¨
let lastSpawnIndex = -1;

function setupScoop(){
  if (!scGridBg.childElementCount){
    for(let i=0;i<16;i++){ const c=document.createElement('div'); c.className='cell'; scGridBg.appendChild(c); }
  }
  best = Number(localStorage.getItem('scoop_best') || 0);
  scoreNow = 0; board = new Array(16).fill(0); prevState=null;
  spawn(); spawn();
  draw();
  scResult.style.display='none';
}

/* 2(90%) / 4(10%) ã‚’ãƒ©ãƒ³ãƒ€ãƒ ç©ºããƒã‚¹ã« */
function spawn(){
  const zeros = board.map((v,i)=>v===0?i:null).filter(v=>v!==null);
  if (!zeros.length) return false;
  const pos = zeros[Math.floor(Math.random()*zeros.length)];
  board[pos] = Math.random()<0.9 ? 2 : 4;
  lastSpawnIndex = pos;
  return true;
}

function canMove(){
  if (board.includes(0)) return true;
  for (let r=0;r<4;r++) for(let c=0;c<4;c++){
    const i=r*4+c, v=board[i];
    if (c<3 && board[i+1]===v) return true;
    if (r<3 && board[i+4]===v) return true;
  }
  return false;
}

function lineMove(line){
  let arr = line.filter(v=>v!==0);
  let scoreGain = 0;
  for(let i=0;i<arr.length-1;i++){
    if (arr[i]!==0 && arr[i]===arr[i+1]){
      arr[i]*=2; scoreGain += arr[i]; arr[i+1]=0; i++;
    }
  }
  arr = arr.filter(v=>v!==0);
  while(arr.length<4) arr.push(0);
  return {line:arr, gain:scoreGain};
}

function move(dir){
  const before = board.slice();
  prevState = {board: before.slice(), score: scoreNow};
  let totalGain = 0;

  if (dir==='L' || dir==='R'){
    for(let r=0;r<4;r++){
      let row = board.slice(r*4, r*4+4);
      if (dir==='R') row.reverse();
      const {line,gain} = lineMove(row);
      totalGain += gain;
      if (dir==='R') line.reverse();
      for(let c=0;c<4;c++) board[r*4+c]=line[c];
    }
  } else {
    for(let c=0;c<4;c++){
      let col = [board[c],board[c+4],board[c+8],board[c+12]];
      if (dir==='D') col.reverse();
      const {line,gain} = lineMove(col);
      totalGain += gain;
      if (dir==='D') line.reverse();
      [board[c],board[c+4],board[c+8],board[c+12]] = line;
    }
  }

  if (board.join('') === before.join('')){ prevState = null; return; }

  scoreNow += totalGain;
  if (scoreNow>best){ best=scoreNow; localStorage.setItem('scoop_best', String(best)); }
  spawn();
  draw();
  checkState();
}

function checkState(){
  const maxTile = Math.max(...board);
  if (maxTile >= 2048){
    scResult.style.display='block';
    scResult.innerHTML = `<strong>ğŸ‰ 2048é”æˆï¼${IMAGE_LABEL[2048] || ''}</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`;
  } else {
    scResult.style.display='none';
  }
  if (!canMove()){
    scResult.style.display='block';
    scResult.innerHTML = `<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã‚¹ã‚³ã‚¢ ${scoreNow}ï¼ˆãƒ™ã‚¹ãƒˆ ${best}ï¼‰ ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;
  }
}

function draw(){
  scTiles.innerHTML='';
  for(let i=0;i<16;i++){
    const slot = document.createElement('div');
    slot.className='slot';
    const v = board[i];
    if (v){
      const t = document.createElement('div');
      t.className = `tile t${v} ${i===lastSpawnIndex?'spawn':''}`;
      if (v >= 128){
        const img = document.createElement('img');
        img.className = 'tileImg';
        img.src = `puzzle${v}.png`;
        img.alt = IMAGE_LABEL[v] || String(v);
        img.addEventListener('error', ()=>{ img.remove(); t.innerHTML=`<b>${v}</b>`; });
        t.appendChild(img);
      } else {
        t.innerHTML = `<b>${v}</b>`;
      }
      slot.appendChild(t);
    }
    scTiles.appendChild(slot);
  }
  scScore.textContent = `ã‚¹ã‚³ã‚¢: ${scoreNow}`;
  scBest.textContent  = `ãƒ™ã‚¹ãƒˆ: ${best}`;
}

/* å…¥åŠ›ï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ & ã‚¹ãƒ¯ã‚¤ãƒ— & ç”»é¢ä¸‹ãƒ‘ãƒƒãƒ‰ï¼‰ */
window.addEventListener('keydown', (e)=>{
  if (views.scoop.style.display!=='block') return;
  const k=e.key;
  if (k==='ArrowLeft') move('L');
  else if (k==='ArrowRight') move('R');
  else if (k==='ArrowUp') move('U');
  else if (k==='ArrowDown') move('D');
});
let touchStartX=0, touchStartY=0;
scTiles.addEventListener('touchstart', (e)=>{ const t=e.touches[0]; touchStartX=t.clientX; touchStartY=t.clientY; }, {passive:true});
scTiles.addEventListener('touchend', (e)=>{
  const t=e.changedTouches[0]; const dx=t.clientX-touchStartX, dy=t.clientY-touchStartY;
  const ax=Math.abs(dx), ay=Math.abs(dy), TH=24;
  if (ax<TH && ay<TH) return;
  if (ax>ay) move(dx>0?'R':'L'); else move(dy>0?'D':'U');
}, {passive:true});
document.querySelector('#scPad .up')   .addEventListener('click', ()=>move('U'));
document.querySelector('#scPad .down') .addEventListener('click', ()=>move('D'));
document.querySelector('#scPad .left') .addEventListener('click', ()=>move('L'));
document.querySelector('#scPad .right').addEventListener('click', ()=>move('R'));

scUndo.addEventListener('click', ()=>{
  if (!prevState) return;
  board = prevState.board.slice(); scoreNow = prevState.score; prevState=null;
  draw(); scResult.style.display='none';
});
scRetry.addEventListener('click', setupScoop);

</script>
</body>
</html>
