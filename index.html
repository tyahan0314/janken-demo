<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ãƒœãƒªãƒ¥ãƒ¼ãƒŸãƒ¼åº—é•·ã®ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒ¼ã‚¯</title>
<style>
  :root{
    --bg:#97d2e4; --ink:#0c2a33; --muted:#215b6b; --white:#fff;
    --pill:#e6f7fd; --btn:#10aee3; --btn-ink:#fff; --card:#ffffffef;
    --win:#0da66e; --lose:#d94848; --accent:#e53935;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans JP",sans-serif}
  .wrap{min-height:100dvh;display:flex;flex-direction:column;align-items:center}
  .container{width:min(920px,92vw);margin:0 auto;padding:16px 0 24px}

  h1{margin:8px 0 6px;font-size:clamp(22px,6vw,36px);letter-spacing:.06em;text-align:center}
  .sub{margin:0 0 12px;color:var(--muted);text-align:center;font-size:clamp(12px,3.6vw,15px)}
  .pill{display:inline-block;padding:.5em 1em;border-radius:999px;background:var(--pill);
    font-weight:800;color:#083b48;font-size:clamp(12px,3.8vw,16px)}
  .btnrow{display:flex;gap:14px;justify-content:center;align-items:center;margin:12px 0 0;flex-wrap:wrap}
  .btn{appearance:none;border:none;border-radius:14px;cursor:pointer;font-weight:800;letter-spacing:.06em}
  .btn.primary{background:var(--btn);color:var(--btn-ink);padding:14px 22px;font-size:clamp(14px,4.8vw,18px)}
  .btn.ghost{background:transparent;color:#083b48;border:2px solid #083b4840;
    padding:12px 20px;border-radius:16px;font-size:clamp(14px,4.8vw,18px)}

  /* ==== ã‚¿ã‚¤ãƒˆãƒ« ==== */
  #title{display:grid;place-items:center}
  #title .panel{
    width:100%;display:grid;place-items:center;padding:16px;
    background: url("bg-title.png") center/cover no-repeat;
    border-radius:18px; min-height:min(92svh,1100px);
  }
  #title .glass{
    width:min(720px,92%); backdrop-filter: blur(0px);
    display:flex; flex-direction:column; align-items:center; gap:14px;
  }
  #titlePic{width:min(640px,88vw);max-height:62svh;object-fit:contain}

  /* ==== å…±é€šã‚«ãƒ¼ãƒ‰ ==== */
  .card{background:var(--card);border-radius:16px;padding:12px 14px;box-shadow:0 12px 28px #07495926}

  /* ==== 2048 ==== */
  #scoop{display:none}
  .scoopHud{display:flex;gap:16px;justify-content:center;align-items:center;flex-wrap:wrap;font-weight:800;margin:8px 0}
  .scoopHud span{background:#ffffffcc;padding:8px 12px;border-radius:10px;box-shadow:0 6px 16px #00000012}
  .scoopBoard{width:min(540px,92vw);margin:12px auto 0;position:relative}
  .scGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;background:#bde3ef;padding:10px;border-radius:14px}
  .scGrid .cell{aspect-ratio:1/1;border-radius:10px;background:#e6f7fd}
  .scTiles{position:absolute;inset:0;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:10px}
  .scTiles>.slot{aspect-ratio:1/1}
  .tile{width:100%;height:100%;border-radius:12px;display:grid;place-items:center;font-weight:900;
    text-align:center;line-height:1.1;box-shadow:0 10px 24px rgba(0,0,0,.12);user-select:none;animation:tileIn .18s ease;
    color:#083b48;font-size:clamp(12px,3.6vw,15px)}
  .tile b{display:block;font-size:clamp(18px,6vw,26px)}
  @keyframes tileIn{from{transform:scale(.84);opacity:0}to{transform:scale(1);opacity:1}}
  .tile.new{outline:3px solid #fff; box-shadow:0 0 0 3px rgba(16,174,227,.35) inset}
  .t2{background:#fffdf5}.t4{background:#fff6da}.t8{background:#ffe1e9}.t16{background:#f6d7c7}
  .t32{background:#d8f0dc}.t64{background:#d7f0fb}.t128{background:#ffe9c2}.t256{background:#f7d9ff}
  .t512{background:#d9fff1}.t1024{background:#fff0c5}.t2048{background:#ffe7e7}
  .tileImg{width:86%;height:86%;object-fit:contain;pointer-events:none}
  #scPad{position:sticky;bottom:env(safe-area-inset-bottom,12px);display:none;margin-top:16px;z-index:5}
  .pad{width:190px;height:170px;margin:0 auto;position:relative;display:grid;place-items:center}
  .pad button{position:absolute;width:56px;height:56px;border-radius:50%;border:none;background:#ffffffd8;
    box-shadow:0 8px 18px #00000018;font-size:22px;font-weight:900;color:#0c2a33;cursor:pointer}
  .pad .up{top:0;left:50%;transform:translate(-50%,0)} .pad .down{bottom:0;left:50%;transform:translate(-50%,0)}
  .pad .left{left:0;top:50%;transform:translate(0,-50%)} .pad .right{right:0;top:50%;transform:translate(0,-50%)}

  /* ==== ã˜ã‚ƒã‚“ã‘ã‚“ ==== */
  #game{display:none}
  .topRow{margin-top:4px;display:flex;align-items:flex-start;justify-content:space-between;gap:clamp(10px,4vw,18px)}
  .frameBox{position:relative;flex:0 0 auto;width:clamp(160px,40vw,320px);aspect-ratio:3/4;background:url("frame2.png") center/contain no-repeat}
  .bossHandImg{position:absolute;left:8%;top:6%;width:84%;height:88%;object-fit:contain;filter:drop-shadow(0 10px 16px #00000018)}
  .bossPic{flex:0 0 auto;width:clamp(200px,42vw,360px);height:auto;object-fit:contain;filter:drop-shadow(0 10px 20px rgba(0,0,0,.12))}
  .hands{margin:16px auto 0;display:flex;justify-content:center;gap:clamp(12px,4vw,18px)}
  .handBtn{width:clamp(92px,22vw,136px);aspect-ratio:1/1;border-radius:18px;background:var(--white);
    box-shadow:0 10px 30px #075a6a22;display:grid;place-items:center;font-size:clamp(34px,10vw,52px);cursor:pointer;border:none}
  .resultCard{display:none;margin:12px auto 0;max-width:720px;background:var(--card);border-radius:16px;padding:12px 14px;text-align:center;font-size:clamp(14px,4.4vw,18px);box-shadow:0 12px 28px #07495926}
  .restartRow{display:none;justify-content:center;margin:14px 0 0}
  .win{color:var(--win);font-weight:800}.lose{color:var(--lose);font-weight:800}
  .score{margin:12px 0 6px;text-align:center;font-weight:800;font-size:clamp(22px,7.2vw,34px)}
  .message{margin:8px 0 18px;text-align:center;font-size:clamp(14px,4.2vw,18px)}

  /* ==== 1äººç”¨ ç¥çµŒè¡°å¼± ==== */
  #memory{display:none}
  .memDiff{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin:6px 0 6px}
  .memHud{display:flex;gap:14px;justify-content:center;align-items:center;margin:10px 0 10px;font-weight:700;flex-wrap:wrap}
  .memGrid{--gap:clamp(10px,3.4vw,14px);display:grid;gap:var(--gap);grid-template-columns:repeat(4,1fr);width:min(740px,92vw);margin:0 auto}
  .memCard{aspect-ratio:1/1;perspective:1000px;position:relative}
  .memInner{position:absolute;inset:0;transition:transform .42s ease;transform-style:preserve-3d;transform:rotateY(180deg)}
  .memInner.flipped{transform:rotateY(0deg)}
  .memFace{position:absolute;inset:0;border-radius:16px;overflow:hidden;backface-visibility:hidden;box-shadow:0 10px 24px rgba(0,0,0,.12);display:grid;place-items:center}
  .memFace.front{background:#fff} .memFace.back{background:linear-gradient(135deg,#c9f0ff,#97d2e4);color:#084357;font-size:clamp(22px,6.4vw,28px);transform:rotateY(180deg)}
  .memFace.front img{width:78%;height:78%;object-fit:contain;pointer-events:none}
  .memInner.matched{animation:pop .36s ease}
  @keyframes pop{0%{transform:rotateY(0) scale(1)}50%{transform:rotateY(0) scale(1.06)}100%{transform:rotateY(0) scale(1)}}
  .lives{display:flex;gap:6px;align-items:center;font-size:clamp(18px,5.4vw,22px)}
  .lives .heart{transition:.2s ease}.lives .heart.lost{opacity:.3;filter:grayscale(1);transform:scale(.92)}

  /* ==== 2äººå¯¾æˆ¦ï¼šå…±é€š ==== */
  #versusSetup,#versusMenu,#ttt,#c4,#mem2{display:none}
  .players{display:flex;gap:16px;justify-content:center;flex-wrap:wrap}
  .pickCol{flex:1 1 300px;max-width:360px}
  .hGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .charBtn{border:none;background:#fff;border-radius:16px;padding:6px 6px 10px;display:flex;flex-direction:column;align-items:center;cursor:pointer;box-shadow:0 8px 18px #00000018}
  .charBtn img{width:100%;aspect-ratio:3/4;object-fit:contain}
  .charBtn b{margin-top:6px}
  .miniBadge{display:inline-flex;gap:6px;align-items:center;background:#fff;border-radius:999px;padding:6px 10px;box-shadow:0 8px 18px #0000001a}
  .miniBadge img{width:30px;height:30px;border-radius:999px;object-fit:cover}
  .miniBadge .active{outline:4px solid var(--accent);outline-offset:2px;border-radius:999px}

  /* â—‹Ã— */
  .tttBoard{width:min(560px,92vw);margin:12px auto;padding:18px;border-radius:18px;background:#bde3ef url('stage33.png') center/cover no-repeat;box-shadow:inset 0 0 0 6px #54a6d7}
  .tttGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
  .tttCell{aspect-ratio:1/1;border-radius:14px;background:#e6f7fd;display:grid;place-items:center;cursor:pointer;font-size:56px;font-weight:900;color:#16414f}

  /* å››ç›®ï¼ˆ7x6ï¼‰ */
  .c4Board{width:min(720px,95vw);margin:12px auto;padding:16px;border-radius:18px;background:#bde3ef url('stage76.png') center/cover no-repeat;box-shadow:inset 0 0 0 8px #2c8bd0;position:relative}
  .c4Grid{display:grid;grid-template-columns:repeat(7,1fr);gap:10px}
  .c4Cell{aspect-ratio:1/1;border-radius:999px;background:#e6f7fd;position:relative;overflow:hidden}
  .token{position:absolute;inset:8% 8% 8% 8%;border-radius:999px;background:#fff;display:grid;place-items:center;box-shadow:0 6px 12px #00000022}
  .token img{width:100%;height:100%;object-fit:contain;border-radius:999px}
  /* è½ä¸‹ã‚¢ãƒ‹ãƒ¡ï¼ˆç°¡æ˜“ï¼‰ */
  .drop{animation:drop .28s ease-out}
  @keyframes drop{from{transform:translateY(-140%)}to{transform:translateY(0)}}

  /* 2Pç¥çµŒè¡°å¼±ï¼ˆã‚¹ã‚³ã‚¢åˆ¶ï¼‰ */
  .scoreRow{display:flex;justify-content:center;gap:12px;flex-wrap:wrap;margin:8px 0}
  .scoreRow .miniBadge img{width:38px;height:38px}
  .mem2Grid{--gap:clamp(10px,3.4vw,14px);display:grid;gap:var(--gap);grid-template-columns:repeat(4,1fr);width:min(740px,92vw);margin:8px auto}
  .mem2Card{aspect-ratio:1/1;position:relative;border-radius:14px;background:#e6f7fd;display:grid;place-items:center;cursor:pointer;box-shadow:0 8px 18px #0000001a}
  .mem2Card img{width:80%;height:80%;object-fit:contain}
  .turnRing{outline:4px solid var(--accent);outline-offset:2px;border-radius:999px}
</style>
</head>
<body>
<div class="wrap">

  <!-- ===== ã‚¿ã‚¤ãƒˆãƒ« ===== -->
  <div class="container" id="title">
    <div class="panel">
      <div class="glass">
        <span class="pill">ãƒŸãƒ‹ã‚²ãƒ¼ãƒ ãƒ‘ãƒ¼ã‚¯</span>
        <img id="titlePic" src="title-start2.png" alt="åº—é•·">
        <div class="btnrow">
          <button class="btn primary" id="btnScoop">2048ã§éŠã¶</button>
          <button class="btn ghost" id="btnVersus">2äººã§éŠã¶</button>
        </div>
        <div class="btnrow">
          <button class="btn ghost" id="btnMem">ç¥çµŒè¡°å¼±ï¼ˆ1äººï¼‰</button>
          <button class="btn ghost" id="btnStart">ã˜ã‚ƒã‚“ã‘ã‚“</button>
        </div>
        <p class="sub">åº—é•· vs ã¿ã‚“ãªã§ã€ã‚†ã‚‹ã£ã¨å¯¾æˆ¦ï¼</p>
      </div>
    </div>
  </div>

  <!-- ===== 2048 ===== -->
  <div class="container" id="scoop">
    <h1>ã€œ2048ãƒ‘ã‚ºãƒ«ã€œ</h1>
    <p class="sub">åŒã˜æ•°å­—ã‚’åˆä½“ã•ã›ã¦é«˜ã‚¹ã‚³ã‚¢ã‚’ç›®æŒ‡ãã†</p>

    <div class="scoopHud">
      <span id="scScore">ã‚¹ã‚³ã‚¢: 0</span>
      <span id="scBest">ãƒ™ã‚¹ãƒˆ: 0</span>
      <div class="btnrow" style="margin:0">
        <button class="btn ghost" id="scUndo">1æ‰‹æˆ»ã‚‹</button>
        <button class="btn ghost" id="scRetry">ã‚‚ã†ä¸€å›</button>
      </div>
    </div>

    <div class="scoopBoard">
      <div class="scGrid" id="scGridBg"></div>
      <div class="scTiles" id="scTiles"></div>
    </div>

    <div class="resultCard" id="scResult" style="display:none;margin-top:14px"></div>

    <div id="scPad"><div class="pad">
      <button class="up">â†‘</button><button class="left">â†</button>
      <button class="right">â†’</button><button class="down">â†“</button>
    </div></div>

    <div class="btnrow" style="margin-top:10px">
      <button class="btn ghost" id="scBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button>
    </div>
  </div>

  <!-- ===== ã˜ã‚ƒã‚“ã‘ã‚“ ===== -->
  <div class="container" id="game">
    <div class="topRow">
      <div class="frameBox"><img id="bossHandImg" class="bossHandImg" src="rock2.png" alt="åº—é•·ã®æ‰‹"></div>
      <img class="bossPic" src="boss2.png" alt="åº—é•·">
    </div>
    <h1>ï½åº—é•·ã¨ã‚¸ãƒ£ãƒ³ã‚±ãƒ³å‹è² ï½</h1>
    <p class="sub">å…ˆã«3å›å‹ã£ãŸæ–¹ãŒå‹ã¡ï¼</p>
    <div class="score" id="score">ã‚ãªãŸ 0 - åº—é•· 0</div>
    <div class="message" id="message">æ‰‹ã‚’é¸ã‚“ã§ã­ï¼</div>
    <div class="hands" id="hands">
      <button class="handBtn" data-hand="rock"     aria-label="ã‚°ãƒ¼">âœŠ</button>
      <button class="handBtn" data-hand="scissors" aria-label="ãƒãƒ§ã‚­">âœŒï¸</button>
      <button class="handBtn" data-hand="paper"    aria-label="ãƒ‘ãƒ¼">âœ‹</button>
    </div>
    <div class="resultCard" id="resultCard"></div>
    <div class="restartRow" id="restartRow"><button class="btn ghost" id="restartBtn">å†æŒ‘æˆ¦</button></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="backToTitle1">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 1äººç”¨ ç¥çµŒè¡°å¼± ===== -->
  <div class="container" id="memory">
    <h1>ã€œç¥çµŒè¡°å¼±ã€œ</h1>
    <p class="sub">åŒã˜ã‚¢ã‚¤ã‚¹ã‚’2æšã‚ãã£ã¦ãƒšã‚¢ã‚’ä½œã‚ã†ï¼</p>
    <div class="memDiff">
      <button class="btn primary" id="memEasyBtn">ã‚„ã•ã—ã„ï¼ˆ4ãƒšã‚¢ï¼‰</button>
      <button class="btn ghost"   id="memHardBtn">ã‚€ãšã‹ã—ã„ï¼ˆ6ãƒšã‚¢ï¼‰</button>
    </div>
    <div class="memHud" id="memHud" style="display:none">
      <span id="memMoves">æ‰‹æ•°: 0</span><span id="memPairs">ãƒšã‚¢: 0 / 4</span>
      <span class="lives" id="memLives"><span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span><span class="heart">ğŸ©µ</span></span>
      <button class="btn ghost" id="memRetry">ã‚‚ã†ä¸€å›</button>
    </div>
    <div class="memGrid" id="memGrid"></div>
    <div class="resultCard" id="memResult" style="display:none;margin-top:14px"></div>
    <div class="btnrow" style="margin-top:10px"><button class="btn ghost" id="memBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 2äººå¯¾æˆ¦ï¼šã‚­ãƒ£ãƒ©é¸æŠ ===== -->
  <div class="container" id="versusSetup">
    <h1>2äººã§éŠã¶</h1>
    <p class="sub">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1ã¨2ã®ã‚­ãƒ£ãƒ©ã‚’é¸ã‚“ã§ã­ï¼ˆåŒã˜ã¯åº—é•·ã ã‘å¯ãƒ»è¡¨ç¤ºã§çŸ¥ã‚‰ã›ã¾ã›ã‚“ï¼‰</p>
    <div class="players">
      <div class="pickCol">
        <h3>P1</h3>
        <div class="hGrid" id="pickP1"></div>
      </div>
      <div class="pickCol">
        <h3>P2</h3>
        <div class="hGrid" id="pickP2"></div>
      </div>
    </div>
    <div class="btnrow"><button class="btn primary" id="goVersusMenu">ã‚²ãƒ¼ãƒ ã‚’é¸ã¶</button></div>
    <div class="btnrow"><button class="btn ghost" id="vsBack1">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 2äººå¯¾æˆ¦ï¼šã‚²ãƒ¼ãƒ é¸æŠ ===== -->
  <div class="container" id="versusMenu">
    <h1>ã‚²ãƒ¼ãƒ ã‚’é¸ã¶</h1>
    <p class="sub">å…ˆæ”»ãƒ»å¾Œæ”»ã¯ãƒ©ãƒ³ãƒ€ãƒ ã§æ±ºã¾ã‚‹ã‚ˆ</p>
    <div class="btnrow">
      <button class="btn primary" id="goTTT">â—¯Ã—ã‚²ãƒ¼ãƒ </button>
      <button class="btn primary" id="goC4">ã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰</button>
      <button class="btn primary" id="goMem2">ç¥çµŒè¡°å¼±ï¼ˆ7ç¨®é¡ï¼‰</button>
    </div>
    <div class="btnrow"><button class="btn ghost" id="vsBack2">ã‚­ãƒ£ãƒ©ã‚’é¸ã³ç›´ã™</button></div>
    <div class="btnrow"><button class="btn ghost" id="vsBackTitle">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 2Pï¼šâ—¯Ã— ã‚²ãƒ¼ãƒ  ===== -->
  <div class="container" id="ttt">
    <h1>ã€œâ—¯Ã—ã‚²ãƒ¼ãƒ ã€œ</h1>
    <div class="btnrow" id="tttBadges"></div>
    <div class="tttBoard">
      <div class="tttGrid" id="tttGrid"></div>
    </div>
    <div class="resultCard" id="tttResult" style="display:none"></div>
    <div class="btnrow">
      <button class="btn ghost" id="tttAgain">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="tttOther">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
    </div>
    <div class="btnrow"><button class="btn ghost" id="tttBack">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 2Pï¼šå››ç›®ä¸¦ã¹ ===== -->
  <div class="container" id="c4">
    <h1>ã€œã‚³ã‚¤ãƒ³è½ã¨ã—ï¼ˆå››ç›®ä¸¦ã¹ï¼‰ã€œ</h1>
    <div class="btnrow" id="c4Badges"></div>
    <div class="c4Board"><div class="c4Grid" id="c4Grid"></div></div>
    <div class="resultCard" id="c4Result" style="display:none"></div>
    <div class="btnrow">
      <button class="btn ghost" id="c4Again">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="c4Other">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
    </div>
    <div class="btnrow"><button class="btn ghost" id="c4Back">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

  <!-- ===== 2Pï¼šç¥çµŒè¡°å¼±ï¼ˆ7ç¨®ï¼‰ ===== -->
  <div class="container" id="mem2">
    <h1>ã€œ2äººã§ç¥çµŒè¡°å¼±ã€œ</h1>
    <div class="scoreRow" id="mem2Badges"></div>
    <div class="mem2Grid" id="mem2Grid"></div>
    <div class="resultCard" id="mem2Result" style="display:none"></div>
    <div class="btnrow">
      <button class="btn ghost" id="mem2Again">ã‚‚ã†ä¸€å›</button>
      <button class="btn ghost" id="mem2Other">ä»–ã®ã‚²ãƒ¼ãƒ ã¸</button>
    </div>
    <div class="btnrow"><button class="btn ghost" id="mem2Back">ã‚¿ã‚¤ãƒˆãƒ«ã¸æˆ»ã‚‹</button></div>
  </div>

</div><!-- /.wrap -->

<script>
/* ===== ç”»é¢åˆ‡æ›¿ã®åŸºæœ¬ ===== */
const views = {
  title: document.getElementById('title'),
  scoop: document.getElementById('scoop'),
  game:  document.getElementById('game'),
  memory:document.getElementById('memory'),
  vsSetup:document.getElementById('versusSetup'),
  vsMenu: document.getElementById('versusMenu'),
  ttt: document.getElementById('ttt'),
  c4:  document.getElementById('c4'),
  mem2:document.getElementById('mem2'),
};
function show(id){
  Object.values(views).forEach(v=>v.style.display='none');
  views[id].style.display='block';
  if(id==='scoop'){document.getElementById('scPad').style.display='block';}
  else{document.getElementById('scPad').style.display='none';}
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ===== ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒœã‚¿ãƒ³ ===== */
document.getElementById('btnScoop').onclick=()=>{show('scoop');setupScoop();}
document.getElementById('btnVersus').onclick=()=>{show('vsSetup');renderPick();}
document.getElementById('btnMem').onclick=()=>{showMemoryMenu();}
document.getElementById('btnStart').onclick=()=>{startGame();show('game');}
document.getElementById('scBack').onclick=()=>show('title');

/* --------------------------------------------------
   2048
-------------------------------------------------- */
const scGridBg = document.getElementById('scGridBg');
const scTiles  = document.getElementById('scTiles');
const scScore  = document.getElementById('scScore');
const scBest   = document.getElementById('scBest');
const scUndo   = document.getElementById('scUndo');
const scRetry  = document.getElementById('scRetry');
const scResult = document.getElementById('scResult');

const IMAGE_LABEL = {128:'å±‹å°',256:'ã‚¢ã‚¤ã‚¹',512:'åº—é•·',1024:'åº—é•·ã‚­ãƒ¡ãƒãƒ¼ã‚º',2048:'ç¤¾é•·'};

let board = [], scoreNow = 0, best = Number(localStorage.getItem('scoop_best')||0), prevState=null, justSpawn=-1;

function setupScoop(){
  if (!scGridBg.childElementCount){
    for(let i=0;i<16;i++){ const c=document.createElement('div'); c.className='cell'; scGridBg.appendChild(c); }
  }
  best = Number(localStorage.getItem('scoop_best')||0);
  scoreNow=0; board=new Array(16).fill(0); prevState=null; justSpawn=-1;
  spawn(); spawn(); draw(); scResult.style.display='none';
}
function spawn(){
  const zeros = board.map((v,i)=>v===0?i:null).filter(v=>v!==null);
  if (!zeros.length) return false;
  const pos = zeros[Math.floor(Math.random()*zeros.length)];
  board[pos] = Math.random()<0.9?2:4; justSpawn=pos; return true;
}
function canMove(){
  if (board.includes(0)) return true;
  for(let r=0;r<4;r++)for(let c=0;c<4;c++){
    const i=r*4+c,v=board[i];
    if (c<3&&board[i+1]===v) return true;
    if (r<3&&board[i+4]===v) return true;
  }
  return false;
}
function lineMove(line){
  let arr=line.filter(v=>v!==0), gain=0;
  for(let i=0;i<arr.length-1;i++){
    if(arr[i]===arr[i+1]){arr[i]*=2; gain+=arr[i]; arr[i+1]=0; i++;}
  }
  arr=arr.filter(v=>v!==0); while(arr.length<4)arr.push(0);
  return {line:arr, gain};
}
function move(dir){
  const before=board.slice(); prevState={board:before.slice(),score:scoreNow}; let total=0;
  if (dir==='L'||dir==='R'){
    for(let r=0;r<4;r++){let row=board.slice(r*4,r*4+4); if(dir==='R')row.reverse();
      const {line,gain}=lineMove(row); total+=gain; if(dir==='R')line.reverse();
      for(let c=0;c<4;c++)board[r*4+c]=line[c];
    }
  }else{
    for(let c=0;c<4;c++){let col=[board[c],board[c+4],board[c+8],board[c+12]]; if(dir==='D')col.reverse();
      const {line,gain}=lineMove(col); total+=gain; if(dir==='D')line.reverse();
      [board[c],board[c+4],board[c+8],board[c+12]]=line;
    }
  }
  if (board.join('')===before.join('')){prevState=null;return;}
  scoreNow+=total; if(scoreNow>best){best=scoreNow;localStorage.setItem('scoop_best',String(best));}
  spawn(); draw(); checkState();
}
function checkState(){
  const mx=Math.max(...board);
  if (mx>=2048){scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ‰ 2048é”æˆï¼${IMAGE_LABEL[2048]||''}</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`;}
  else scResult.style.display='none';
  if (!canMove()){scResult.style.display='block'; scResult.innerHTML=`<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã‚¹ã‚³ã‚¢ ${scoreNow}ï¼ˆãƒ™ã‚¹ãƒˆ ${best}ï¼‰</div>`;}
}
function draw(){
  scTiles.innerHTML='';
  for(let i=0;i<16;i++){
    const slot=document.createElement('div'); slot.className='slot';
    const v=board[i];
    if(v){
      const t=document.createElement('div'); t.className=`tile t${v}`; if(i===justSpawn)t.classList.add('new');
      if(v>=128){
        const img=document.createElement('img'); img.className='tileImg'; img.src=`puzzle${v}.png`; img.alt=IMAGE_LABEL[v]||String(v);
        img.onerror=()=>{img.remove(); t.innerHTML=`<b>${v}</b>`}; t.appendChild(img);
      }else{t.innerHTML=`<b>${v}</b>`;}
      slot.appendChild(t);
    }
    scTiles.appendChild(slot);
  }
  scScore.textContent=`ã‚¹ã‚³ã‚¢: ${scoreNow}`; scBest.textContent=`ãƒ™ã‚¹ãƒˆ: ${best}`;
}
window.addEventListener('keydown',e=>{
  if(views.scoop.style.display!=='block')return;
  const k=e.key; if(k==='ArrowLeft')move('L'); else if(k==='ArrowRight')move('R'); else if(k==='ArrowUp')move('U'); else if(k==='ArrowDown')move('D');
});
document.querySelector('#scPad .up').onclick =()=>move('U');
document.querySelector('#scPad .down').onclick=()=>move('D');
document.querySelector('#scPad .left').onclick=()=>move('L');
document.querySelector('#scPad .right').onclick=()=>move('R');
scUndo.onclick=()=>{ if(!prevState)return; board=prevState.board.slice(); scoreNow=prevState.score; prevState=null; justSpawn=-1; draw(); scResult.style.display='none'; }
scRetry.onclick=setupScoop;

/* --------------------------------------------------
   ã˜ã‚ƒã‚“ã‘ã‚“
-------------------------------------------------- */
const scoreEl=document.getElementById('score'), messageEl=document.getElementById('message'),
      handsWrap=document.getElementById('hands'), resultCard=document.getElementById('resultCard'),
      restartRow=document.getElementById('restartRow'), bossHandImg=document.getElementById('bossHandImg');
const WIN_TARGET=3, BOSS_EDGE=0.7, IMG={rock:'rock2.png',scissors:'scissors2.png',paper:'paper2.png'},
      WINMAP={rock:'scissors',scissors:'paper',paper:'rock'};
let score={you:0,boss:0};
function startGame(){ show('game'); resetGame(); }
function resetGame(){ score.you=0;score.boss=0;updateScore();messageEl.textContent='æ‰‹ã‚’é¸ã‚“ã§ã­ï¼';bossHandImg.src=IMG.rock;resultCard.style.display='none';restartRow.style.display='none';handsWrap.style.display='flex';}
function updateScore(){scoreEl.textContent=`ã‚ãªãŸ ${score.you} - åº—é•· ${score.boss}`;}
function bossPick(player){
  const beat={rock:'paper',paper:'scissors',scissors:'rock'}[player];
  const lose=WINMAP[player]; const tie=player; if(Math.random()<BOSS_EDGE)return beat; return Math.random()<.5?lose:tie;
}
function play(player){
  if(handsWrap.style.display==='none')return;
  const boss=bossPick(player); bossHandImg.src=IMG[boss];
  if(player===boss) messageEl.textContent='ã‚ã„ã“ï¼æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­';
  else if(WINMAP[player]===boss){score.you++;updateScore();messageEl.innerHTML=`<span class="win">ã‚ãªãŸã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`;}
  else{score.boss++;updateScore();messageEl.innerHTML=`<span class="lose">åº—é•·ã®å‹ã¡ï¼</span> æ¬¡ã®æ‰‹ã‚’é¸ã‚“ã§ã­`;}
  if(score.you>=WIN_TARGET||score.boss>=WIN_TARGET){
    handsWrap.style.display='none';resultCard.style.display='block';restartRow.style.display='flex';
    resultCard.innerHTML = score.you>=WIN_TARGET?`<strong>ğŸ‰ ã‚ãªãŸã®å‹ã¡ï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`:`<strong>ğŸ‘‘ åº—é•·ã®å‹ã¡ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;
  }
}
document.querySelectorAll('.handBtn').forEach(b=>b.onclick=()=>play(b.dataset.hand));
document.getElementById('restartBtn').onclick=resetGame;
document.getElementById('backToTitle1').onclick=()=>show('title');

/* --------------------------------------------------
   1äººç”¨ ç¥çµŒè¡°å¼±ï¼ˆãƒ©ã‚¤ãƒ•3ï¼‰
-------------------------------------------------- */
const ICE_SET=[
  {img:'ice1.png',emoji:'ğŸ¨',name:'ãƒ—ãƒ¬ãƒ¼ãƒ³'},
  {img:'ice2.png',emoji:'ğŸ«',name:'ãƒãƒ§ã‚³'},
  {img:'ice3.png',emoji:'ğŸµ',name:'ãã®ãèŒ¶'},
  {img:'ice4.png',emoji:'ğŸ””',name:'ã¡ã‚Šã‚“ã¡ã‚Šã‚“ãã‚“'},
  {img:'ice5.png',emoji:'ğŸ‘¨',name:'åº—é•·1'},
  {img:'ice6.png',emoji:'ğŸ§‘',name:'åº—é•·2'}
];
const memGrid=document.getElementById('memGrid'), memHud=document.getElementById('memHud'),
      memMoves=document.getElementById('memMoves'), memPairs=document.getElementById('memPairs'),
      memRetry=document.getElementById('memRetry'), memBack=document.getElementById('memBack'),
      memResult=document.getElementById('memResult'), memLives=document.getElementById('memLives'),
      memEasyBtn=document.getElementById('memEasyBtn'), memHardBtn=document.getElementById('memHardBtn');
const MAX_LIVES=3; let TYPES_COUNT=4, memDeck=[], first=null, second=null, lock=false, pairs=0, moves=0, lives=MAX_LIVES, memOver=false;
function showMemoryMenu(){ show('memory'); memHud.style.display='none'; memGrid.innerHTML=''; memResult.style.display='none';}
memEasyBtn.onclick=()=>startMemory(4); memHardBtn.onclick=()=>startMemory(6);
function startMemory(types=4){
  TYPES_COUNT=types; buildMemDeck(); renderMem(); pairs=0;moves=0;lock=false;first=second=null;memOver=false;lives=MAX_LIVES;
  updateMemHud(); renderLives(); memResult.style.display='none'; memHud.style.display='flex';
}
function updateMemHud(){ memMoves.textContent=`æ‰‹æ•°: ${moves}`; memPairs.textContent=`ãƒšã‚¢: ${pairs} / ${TYPES_COUNT}`;}
function renderLives(){ memLives.querySelectorAll('.heart').forEach((h,i)=>h.classList.toggle('lost',i>=lives)); }
function buildMemDeck(){ memDeck=[]; for(let i=0;i<TYPES_COUNT;i++){memDeck.push({id:i});memDeck.push({id:i});}
  for(let i=memDeck.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[memDeck[i],memDeck[j]]=[memDeck[j],memDeck[i]];}
}
function renderMem(){
  memGrid.innerHTML=''; memDeck.forEach((card,idx)=>{
    const c=document.createElement('div'); c.className='memCard'; c.dataset.index=idx;
    const inner=document.createElement('div'); inner.className='memInner'; inner.setAttribute('role','button');
    const front=document.createElement('div'); front.className='memFace front';
    const img=document.createElement('img'); img.src=ICE_SET[card.id].img; img.alt=ICE_SET[card.id].name;
    const emoji=document.createElement('span'); emoji.textContent=ICE_SET[card.id].emoji; emoji.style.fontSize='clamp(32px,10vw,56px)';
    img.onload=()=>emoji.style.display='none'; img.onerror=()=>img.style.display='none'; front.append(img,emoji);
    const back=document.createElement('div'); back.className='memFace back'; back.textContent='ğŸ¨';
    inner.append(front,back); c.append(inner); memGrid.append(c);
    c.onclick=()=>flipMem(idx,inner);
  });
}
function flipMem(idx,inner){
  if(memOver||lock) return;
  if(inner.classList.contains('flipped')) return;
  inner.classList.add('flipped');
  if(!first){ first={idx,id:memDeck[idx].id,el:inner}; navigator.vibrate?.(15); return; }
  second={idx,id:memDeck[idx].id,el:inner}; lock=true; moves++; updateMemHud();
  if(first.id===second.id){
    setTimeout(()=>{first.el.classList.add('matched'); second.el.classList.add('matched'); pairs++; updateMemHud(); first=second=null; lock=false;
      if(pairs>=TYPES_COUNT){ memOver=true; memResult.style.display='block'; memResult.innerHTML=`<strong>ğŸ‰ ãœã‚“ã¶ãã‚ã£ãŸï¼</strong><div style="margin-top:6px">ãŠã‚ã§ã¨ã†ï¼</div>`;}
      navigator.vibrate?.([20,40,20]);
    },220);
  }else{
    lives=Math.max(0,lives-1); renderLives();
    setTimeout(()=>{first.el.classList.remove('flipped'); second.el.classList.remove('flipped'); first=second=null; lock=false; navigator.vibrate?.(30);
      if(lives<=0&&!memOver){ memOver=true; memResult.style.display='block'; memResult.innerHTML=`<strong>ğŸ’¥ ãŠã—ã¾ã„ï¼</strong><div style="margin-top:6px">ã¾ãŸæŒ‘æˆ¦ã—ã¦ã­ï¼</div>`;}
    },700);
  }
}
memRetry.onclick=()=>startMemory(TYPES_COUNT); memBack.onclick=()=>show('title');

/* --------------------------------------------------
   2äººå¯¾æˆ¦ï¼šã‚­ãƒ£ãƒ© & å…±é€š
-------------------------------------------------- */
const CHAR=[
  {id:1,name:'åº—é•·',icon:'character1.png',winter:'character1-2.png',coin:'coin1.png',coinW:'coin1-2.png',
   lines:{win:'ä¿ºã«å‹ã¨ã†ãªã‚“ã¦100å¹´æ—©ã„ï¼',lose:'ã„ã‚„ãƒ¼ã‚“ï¼'}},
  {id:2,name:'å¥¥ã•ã‚“',icon:'character2.png',coin:'coin2.png',lines:{win:'ç§ãŒ1ç•ªã‚ˆï¼',lose:'ã‚ã‚“ãŸæ¸›çµ¦ã­â€¦'}},
  {id:3,name:'ãƒã‚¤ãƒˆ',icon:'character3.png',coin:'coin3.png',lines:{win:'ã‚„ã£ãŸã£ã™ï¼',lose:'ãƒã‚¸ã‹â€¦'}},
  {id:4,name:'ç¤¾é•·',icon:'character4.png',coin:'coin4.png',lines:{win:'ç§ãŒ1ç•ªã‚ˆï¼',lose:'ã‚ã‚“ãŸæ¸›çµ¦ã­â€¦'}}
];
let P1=null,P2=null; // {id, icon, coin, winter?}

const pickP1=document.getElementById('pickP1'), pickP2=document.getElementById('pickP2');
function renderPick(){
  pickP1.innerHTML=''; pickP2.innerHTML='';
  CHAR.forEach(ch=>{
    const b1=document.createElement('button'); b1.className='charBtn';
    b1.innerHTML=`<img src="${ch.icon}" alt=""><b>${ch.name}</b>`; b1.onclick=()=>{P1=pickResolve(ch,false);};
    pickP1.append(b1);
    const b2=document.createElement('button'); b2.className='charBtn';
    b2.innerHTML=`<img src="${ch.icon}" alt=""><b>${ch.name}</b>`; b2.onclick=()=>{P2=pickResolve(ch,true);};
    pickP2.append(b2);
  });
}
function pickResolve(ch,isP2){
  // åŒã‚­ãƒ£ãƒ©ç¦æ­¢ï¼ˆåº—é•·ã®ã¿ä¾‹å¤–ï¼ç„¡è¨€ã§å†¬æœã«å¤‰æ›ï¼‰
  if(!isP2){ return {id:ch.id, icon:ch.icon, coin:ch.coin, winter:false}; }
  if(P1 && ch.id===P1.id){
    if(ch.id===1){ return {id:1, icon:CHAR[0].winter, coin:CHAR[0].coinW, winter:true}; }
    // ãã‚Œä»¥å¤–ã¯ç„¡è¦–ï¼ˆã‚¢ãƒ©ãƒ¼ãƒˆãªã—ï¼‰
    return P2;
  }
  return {id:ch.id, icon:ch.icon, coin:ch.coin, winter:false};
}
document.getElementById('goVersusMenu').onclick=()=>{
  if(!P1||!P2) return; show('versusMenu');
};
document.getElementById('vsBack1').onclick=()=>show('title');
document.getElementById('vsBack2').onclick=()=>show('vsSetup');
document.getElementById('vsBackTitle').onclick=()=>show('title');

/* --------------------------------------------------
   â—¯Ã—ï¼ˆä¸‰ç›®ä¸¦ã¹ï¼‰
-------------------------------------------------- */
const tttGridEl=document.getElementById('tttGrid'), tttResult=document.getElementById('tttResult'), tttBadges=document.getElementById('tttBadges');
let tttBoard, tttTurn, tttOver=false;
document.getElementById('goTTT').onclick=()=>{startTTT(); show('ttt');};
document.getElementById('tttAgain').onclick=()=>startTTT();
document.getElementById('tttOther').onclick=()=>show('versusMenu');
document.getElementById('tttBack').onclick=()=>show('title');

function startTTT(){
  renderBadges(tttBadges); tttBoard=new Array(9).fill(null); tttTurn=Math.random()<0.5?'P1':'P2'; tttOver=false;
  tttResult.style.display='none'; drawTTT();
}
function drawTTT(){
  // ãƒãƒƒã‚¸ã®èµ¤æ æ›´æ–°
  document.querySelectorAll('#tttBadges .miniBadge img').forEach((img,i)=>{
    img.classList.toggle('turnRing', (tttTurn==='P1'&&i===0)||(tttTurn==='P2'&&i===1));
  });
  tttGridEl.innerHTML='';
  tttBoard.forEach((v,i)=>{
    const cell=document.createElement('div'); cell.className='tttCell';
    cell.textContent = v==='P1'?'Ã—':(v==='P2'?'â—‹':'');
    if(!v && !tttOver){ cell.onclick=()=>putTTT(i); }
    tttGridEl.append(cell);
  });
}
function putTTT(i){
  if(tttBoard[i])return; tttBoard[i]=tttTurn;
  const w=winnerTTT();
  if(w||tttBoard.every(Boolean)){
    tttOver=true; tttResult.style.display='block';
    if(w){ const who=(w==='P1'?P1:P2); const other=(w==='P1'?P2:P1);
      tttResult.innerHTML=`<strong>ğŸ‰ ${w}ã®å‹ã¡ï¼</strong><div style="margin-top:6px">${(w==='P1'?linesOf(P1).win:linesOf(P2).win)}<br>${(w==='P1'?linesOf(P2).lose:linesOf(P1).lose)}</div>`;
    }else tttResult.innerHTML=`<strong>å¼•ãåˆ†ã‘ï¼</strong>`;
  }else{ tttTurn = tttTurn==='P1'?'P2':'P1'; }
  drawTTT();
}
function winnerTTT(){
  const L=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  for(const [a,b,c] of L){ if(tttBoard[a]&&tttBoard[a]===tttBoard[b]&&tttBoard[a]===tttBoard[c]) return tttBoard[a]; }
  return null;
}

/* --------------------------------------------------
   å››ç›®ä¸¦ã¹ï¼ˆ7x6ï¼‰
-------------------------------------------------- */
const c4Grid=document.getElementById('c4Grid'), c4Result=document.getElementById('c4Result'), c4Badges=document.getElementById('c4Badges');
let c4Board, c4Turn, c4Over=false;
document.getElementById('goC4').onclick=()=>{startC4(); show('c4');};
document.getElementById('c4Again').onclick=()=>startC4();
document.getElementById('c4Other').onclick=()=>show('versusMenu');
document.getElementById('c4Back').onclick=()=>show('title');

function startC4(){
  renderBadges(c4Badges); c4Board=[...Array(6)].map(()=>Array(7).fill(null)); c4Turn=Math.random()<0.5?'P1':'P2'; c4Over=false;
  c4Result.style.display='none'; drawC4();
}
function drawC4(){
  // ã‚¿ãƒ¼ãƒ³æ 
  document.querySelectorAll('#c4Badges .miniBadge img').forEach((img,i)=>{
    img.classList.toggle('turnRing',(c4Turn==='P1'&&i===0)||(c4Turn==='P2'&&i===1));
  });
  c4Grid.innerHTML='';
  for(let r=0;r<6;r++)for(let c=0;c<7;c++){
    const cell=document.createElement('div'); cell.className='c4Cell'; cell.dataset.col=c;
    const v=c4Board[r][c];
    if(v){
      const tk=document.createElement('div'); tk.className='token';
      const im=document.createElement('img'); im.src=(v==='P1'?P1.coin:P2.coin);
      tk.append(im); cell.append(tk);
    }
    if(!c4Over){ cell.onclick=()=>dropC4(c); }
    c4Grid.append(cell);
  }
}
function dropC4(col){
  if(c4Over) return;
  let row=5; while(row>=0 && c4Board[row][col]) row--;
  if(row<0) return; // æº€æ¯
  // ç½®ã
  c4Board[row][col]=c4Turn;
  // è½ä¸‹ã‚¢ãƒ‹ãƒ¡ï¼šå¯¾è±¡ã‚»ãƒ«ã« .drop ã‚’ä»˜ã‘ã‚‹ãŸã‚å†æç”»å¾Œã«ã‚¯ãƒ©ã‚¹ä»˜ä¸
  drawC4();
  const idx=row*7+col;
  const cell=c4Grid.children[idx];
  const tk=cell.querySelector('.token'); if(tk){ tk.classList.add('drop'); }
  const w=winnerC4();
  if(w || c4Board.every(r=>r.every(Boolean))){
    c4Over=true; c4Result.style.display='block';
    if(w){ c4Result.innerHTML=`<strong>ğŸ‰ ${w}ã®å‹ã¡ï¼</strong><div style="margin-top:6px">${(w==='P1'?linesOf(P1).win:linesOf(P2).win)}<br>${(w==='P1'?linesOf(P2).lose:linesOf(P1).lose)}</div>`;}
    else{ c4Result.innerHTML=`<strong>å¼•ãåˆ†ã‘ï¼</strong>`; }
  }else{
    c4Turn = c4Turn==='P1'?'P2':'P1';
    drawC4();
  }
}
function winnerC4(){
  const B=c4Board; const H=6,W=7;
  const line=(r,c,dr,dc)=>[0,1,2,3].map(k=>B[r+dr*k]?.[c+dc*k]);
  for(let r=0;r<H;r++)for(let c=0;c<W;c++){
    for(const [dr,dc] of [[0,1],[1,0],[1,1],[1,-1]]){
      const L=line(r,c,dr,dc); if(L.every(v=>v&&v===L[0])) return L[0];
    }
  }
  return null;
}

/* --------------------------------------------------
   2P ç¥çµŒè¡°å¼±ï¼ˆ7ç¨®ãƒ»ã‚¹ã‚³ã‚¢åˆ¶ï¼‰
-------------------------------------------------- */
const mem2Grid=document.getElementById('mem2Grid'), mem2Result=document.getElementById('mem2Result'), mem2Badges=document.getElementById('mem2Badges');
let mem2Deck=[], mem2First=null, mem2Second=null, mem2Lock=false, mem2Turn='P1', mem2Over=false, scoreP1=0, scoreP2=0;
document.getElementById('goMem2').onclick=()=>{startMem2(); show('mem2');};
document.getElementById('mem2Again').onclick=()=>startMem2();
document.getElementById('mem2Other').onclick=()=>show('versusMenu');
document.getElementById('mem2Back').onclick=()=>show('title');

function startMem2(){
  renderBadges(mem2Badges,true);
  mem2Deck=[]; for(let i=0;i<7;i++){mem2Deck.push({id:i}); mem2Deck.push({id:i});}
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  for(let i=mem2Deck.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [mem2Deck[i],mem2Deck[j]]=[mem2Deck[j],mem2Deck[i]];}
  mem2First=mem2Second=null; mem2Lock=false; mem2Over=false; scoreP1=0; scoreP2=0; mem2Turn=Math.random()<.5?'P1':'P2';
  mem2Result.style.display='none'; drawMem2();
}
function drawMem2(){
  // ã‚¿ãƒ¼ãƒ³ã®èµ¤æ 
  document.querySelectorAll('#mem2Badges .miniBadge img').forEach((img,i)=>{
    img.classList.toggle('turnRing',(mem2Turn==='P1'&&i===0)||(mem2Turn==='P2'&&i===1));
  });
  mem2Grid.innerHTML='';
  mem2Deck.forEach((card,idx)=>{
    const cell=document.createElement('div'); cell.className='mem2Card'; cell.dataset.idx=idx;
    if(card.open||card.got){
      const im=document.createElement('img'); im.src=`ice${card.id+1}.png`; cell.append(im);
      if(card.got) cell.style.filter='saturate(0.2)';
    }else{
      cell.textContent='ğŸ¨';
    }
    if(!card.got && !card.open && !mem2Over){ cell.onclick=()=>flipMem2(idx); }
    mem2Grid.append(cell);
  });
  // ã‚¹ã‚³ã‚¢è¡¨ç¤ºã®æ›´æ–°
  const s = document.createElement('div');
}
function flipMem2(i){
  if(mem2Lock||mem2Deck[i].open||mem2Deck[i].got) return;
  mem2Deck[i].open=true; drawMem2();
  if(!mem2First){ mem2First=i; return; }
  mem2Second=i; mem2Lock=true;
  setTimeout(()=>{
    if(mem2Deck[mem2First].id===mem2Deck[mem2Second].id){
      mem2Deck[mem2First].got = mem2Deck[mem2Second].got = true;
      if(mem2Turn==='P1') scoreP1++; else scoreP2++;
      // ç¶šã‘ã¦åŒã˜ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¿ãƒ¼ãƒ³
    }else{
      mem2Deck[mem2First].open = mem2Deck[mem2Second].open = false;
      mem2Turn = mem2Turn==='P1'?'P2':'P1';
    }
    mem2First=mem2Second=null; mem2Lock=false;
    drawMem2();
    if(mem2Deck.every(c=>c.got)){
      mem2Over=true; mem2Result.style.display='block';
      const w = scoreP1===scoreP2?null:(scoreP1>scoreP2?'P1':'P2');
      if(w){
        mem2Result.innerHTML=`<strong>ğŸ‰ ${w}ã®å‹ã¡ï¼</strong><div style="margin-top:6px">${(w==='P1'?linesOf(P1).win:linesOf(P2).win)}<br>${(w==='P1'?linesOf(P2).lose:linesOf(P1).lose)}</div>`;
      }else{
        mem2Result.innerHTML=`<strong>å¼•ãåˆ†ã‘ï¼</strong>`;
      }
    }
  },500);
}

/* å…±é€šï¼šãƒãƒƒã‚¸ãƒ»ã‚»ãƒªãƒ• */
function renderBadges(host,showLines=false){
  host.innerHTML='';
  const mk=(p,label)=>{const b=document.createElement('div'); b.className='miniBadge';
    b.innerHTML=`<img src="${p.icon}" alt=""><b>${label}</b>${showLines?`<div style="font-size:12px;color:#215b6b;margin-left:8px"></div>`:''}`;
    return b;}
  host.append(mk(P1,'P1'), mk(P2,'P2'));
}
function linesOf(p){
  const ch=CHAR.find(c=>c.id===p.id) || CHAR[0];
  return ch.lines || {win:'å‹åˆ©ï¼',lose:'ã†ãã£â€¦'};
}

/* ===== ã‚¿ã‚¤ãƒˆãƒ«â†’å„å…¥å£ ===== */
document.getElementById('mem2Badges'); // (ãƒ€ãƒŸãƒ¼å‚ç…§ã§ãƒ„ãƒ¼ãƒ«è­¦å‘Šå›é¿)
</script>
</body>
</html>
