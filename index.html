<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>店長とジャンケン勝負！</title>
  <style>
    /* ===== ベース ===== */
    :root {
      --space-top: calc(env(safe-area-inset-top) + 8px);
      --radius: 12px;
    }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      text-align: center;
      background: #87CEEB;
      margin: 0; padding: 0;
    }
    h1{
      margin: clamp(8px,2.6vw,16px) 0 0;
      font-size: clamp(18px,6vw,28px);
    }
    .top-note{
      margin: 4px 0 0;
      font-size: clamp(12px,3.8vw,16px);
      opacity: .9;
    }

    /* ===== 右上：店長、左上：店長の手（枠） ===== */
    #boss{
      position: fixed;
      top: var(--space-top);
      right: 10px;
      width: clamp(72px,18vw,120px);
      z-index: 5;
      user-select: none;
      -webkit-user-drag: none;
    }
    #frame{
      position: fixed;
      top: var(--space-top);
      left: 10px;
      width: clamp(84px,22vw,140px);
      height: clamp(84px,22vw,140px);
      background: url('frame.png') no-repeat center/contain;
      display: flex; align-items: center; justify-content: center;
      z-index: 4;
      user-select: none;
    }
    #cpuHand{
      width: 70%;
      height: auto;
      display: none; /* 初期は手を非表示（枠だけ） */
      -webkit-user-drag: none;
    }

    /* ===== 中央エリア ===== */
    #gameArea{
      min-height: 60vh;
      margin-top: clamp(120px,28vw,200px); /* 上の固定要素と干渉しない */
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      gap: clamp(8px,2.6vw,16px);
      padding: 0 12px 24px;
    }
    #score{
      font-size: clamp(16px,4.8vw,22px);
      font-weight: 700;
    }
    #result{
      font-size: clamp(14px,4.5vw,20px);
      line-height: 1.5;
      min-height: 1.5em;
    }

    /* 手ボタン */
    #choices{ display: flex; gap: clamp(10px,4vw,16px); }
    #choices button{
      font-size: clamp(24px,8.5vw,38px);
      padding: clamp(8px,2.8vw,12px) clamp(10px,3.6vw,16px);
      border: none; border-radius: var(--radius);
      background: #fff;
      box-shadow: 0 2px 0 rgba(0,0,0,.12);
      cursor: pointer;
      transition: transform .06s ease-in-out;
    }
    #choices button:active{ transform: translateY(1px); }

    /* 合言葉・再挑戦 */
    #keywordBox{
      display: none;
      margin-top: clamp(8px,2.8vw,12px);
      padding: clamp(8px,2.8vw,12px) clamp(12px,4vw,16px);
      background: #fff;
      border-radius: var(--radius);
      font-size: clamp(14px,4.2vw,18px);
      box-shadow: 0 2px 0 rgba(0,0,0,.08);
    }
    #keywordBox .kw-note{ margin-top: 6px; font-size: .9em; opacity: .85; }
    #copyKw{
      margin-left: 8px; padding: 6px 10px; font-size: .95em;
      border: none; border-radius: 8px; background: #efefef; cursor: pointer;
    }
    #retry{
      display: none;
      margin: clamp(10px,3vw,16px) auto 0;
      padding: clamp(10px,3vw,14px) clamp(16px,4.5vw,22px);
      font-size: clamp(14px,4.5vw,18px);
      background: #ff7f7f; color: #fff;
      border: none; border-radius: var(--radius); cursor: pointer;
    }

    /* 横幅が広めの端末で少し締める */
    @media (min-width: 640px){
      #gameArea{ max-width: 520px; margin-left:auto; margin-right:auto; }
    }
  </style>
</head>
<body>
  <h1>〜店長とジャンケン勝負〜</h1>
  <p class="top-note">先に3回勝った方が勝ち！</p>

  <img id="boss" src="boss.png" alt="店長">
  <div id="frame">
    <img id="cpuHand" alt="店長の手">
  </div>

  <div id="gameArea">
    <div id="score">あなた 0 - 店長 0</div>
    <div id="result"></div>

    <div id="choices">
      <button onclick="play('rock')">✊</button>
      <button onclick="play('scissors')">✌️</button>
      <button onclick="play('paper')">🖐️</button>
    </div>

    <div id="keywordBox">
      合言葉：<strong id="keywordText">ボリューミー店長</strong>
      <button id="copyKw" onclick="copyKeyword()">コピー</button>
      <div class="kw-note">LINEのトークでこの合言葉を送ってね</div>
    </div>

    <button id="retry" onclick="resetGame()">再挑戦</button>
  </div>

  <script>
    /* ==== 店長の強さ（勝ち手を出す確率） ==== */
    const BOSS_SMART_RATE = 0.75; // 例: 0.6=やや弱い / 0.75=強め / 0.85=かなり強い
    const KEYWORD = 'ボリューミー店長';

    /* ==== 状態 ==== */
    let playerScore = 0;
    let bossScore = 0;
    let gameOver = false;

    /* ==== 店長の手決定 ==== */
    function cpuChoice(player) {
      const counter = (h) => (h === 'rock' ? 'paper' : h === 'scissors' ? 'rock' : 'scissors');
      const rnd = () => ['rock', 'scissors', 'paper'][Math.floor(Math.random() * 3)];
      return Math.random() < BOSS_SMART_RATE ? counter(player) : rnd();
    }

    /* ==== 1ターン実行 ==== */
    function play(playerHand) {
      if (gameOver) return;

      const bossHand = cpuChoice(playerHand);
      const cpuImg = document.getElementById('cpuHand');
      cpuImg.src = bossHand + '.png';
      cpuImg.style.display = 'block';

      let result;
      if (
        (playerHand === 'rock' && bossHand === 'scissors') ||
        (playerHand === 'scissors' && bossHand === 'paper') ||
        (playerHand === 'paper' && bossHand === 'rock')
      ) {
        playerScore++; result = 'あなたの勝ち！';
      } else if (playerHand === bossHand) {
        result = 'あいこ！';
      } else {
        bossScore++; result = '店長の勝ち！';
      }

      document.getElementById('result').textContent = result;
      document.getElementById('score').textContent = `あなた ${playerScore} - 店長 ${bossScore}`;

      if (playerScore === 3) endGame(true);
      if (bossScore === 3) endGame(false);
    }

    /* ==== 終了処理 ==== */
    function endGame(playerWon) {
      gameOver = true;
      // 手ボタンを隠す
      document.getElementById('choices').style.display = 'none';
      // 再挑戦ボタンを出す
      document.getElementById('retry').style.display = 'block';

      const kwBox = document.getElementById('keywordBox');
      if (playerWon) {
        document.getElementById('result').textContent = '🎉 あなたの勝ち！';
        document.getElementById('keywordText').textContent = KEYWORD;
        kwBox.style.display = 'inline-block';  // 合言葉を表示
      } else {
        document.getElementById('result').textContent = '店長の勝ち！ゲーム終了！';
        kwBox.style.display = 'none';          // 負けなら合言葉は出さない
      }
    }

    /* ==== リセット ==== */
    function resetGame() {
      gameOver = false;
      playerScore = 0; bossScore = 0;
      document.getElementById('score').textContent = 'あなた 0 - 店長 0';
      document.getElementById('result').textContent = '';
      document.getElementById('cpuHand').style.display = 'none';
      document.getElementById('retry').style.display = 'none';
      document.getElementById('keywordBox').style.display = 'none';
      document.getElementById('choices').style.display = 'flex';
    }

    /* ==== 合言葉コピー ==== */
    function copyKeyword(){
      const btn = document.getElementById('copyKw');
      navigator.clipboard?.writeText(KEYWORD).then(()=>{
        const old = btn.textContent;
        btn.textContent = 'コピー済み';
        setTimeout(()=> btn.textContent = old, 1200);
      });
    }
  </script>
</body>
</html>
